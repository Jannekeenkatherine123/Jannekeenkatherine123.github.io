websight.sooqr.Debug={containerElement:void 0,log:function(message){if(null==message)return!1;null==this.containerElement&&(this.containerElement=document.createElement("div"),this.containerElement.id="LogWindow",this.containerElement.style.position="absolute",this.containerElement.style.zIndex="10000",this.containerElement.style.top="45px",this.containerElement.style.left="100%",this.containerElement.style.marginLeft="-315px",this.containerElement.style.backgroundColor="#F7F7F7",this.containerElement.style.border="1px solid #DDDDDD",this.containerElement.style.width="300px",this.containerElement.style.padding="5px",document.body.appendChild(this.containerElement),(messageElement=document.createElement("h3")).style.margin="5px 0px",messageElement.style.fontSize="16px",messageElement.appendChild(document.createTextNode("Debug")),this.containerElement.appendChild(messageElement)),message.toSource&&(message=message.toSource());var messageElement=document.createElement("div");messageElement.appendChild(document.createTextNode(message)),this.containerElement.appendChild(messageElement),this.containerElement.appendChild(document.createElement("HR"))}},function($){$.fn.listHandlers=function(events,outputFunction){return this.each(function(i){var elem=this,dEvents=$(this).data("events");dEvents&&$.each(dEvents,function(name,handler){new RegExp("^("+("*"===events?".+":events.replace(",","|").replace(/^on/i,""))+")$","i").test(name)&&$.each(handler,function(i,handler){outputFunction(elem,"\n"+i+": ["+name+"] : "+handler)})})})}}($jQ),wsDebug=websight.sooqr.Debug.log,websight.sooqr.FilterPanel=function(controllerInstance,parameters,filterQuery){this.controllerInstance=controllerInstance,this.objectName="FilterPanel",this.defaultFilters=this.controllerInstance.parameters.defaultFilters||{},this.defaultSubValues=this.controllerInstance.parameters.defaultSubValues||{},this.parameters=parameters,this.structure=parameters.filters,this.panelElement=$jQ("div.sooqrSearchFilters",controllerInstance.getFilterContainer()),this.formElement=$jQ('<form method="get" action="#"/>'),this.isFilterpanelFixed=!1,this.filterGroupCache={},this.persistentParameters={filtersShowAll:!1,filterValuesShowAll:{}},this.filterContainers={},this.lastInitializedParameters={},this.handleLocationInputTimeout=null,this.lastFilterQuery=filterQuery,this.toArray=function(){var jsonValues={},formValues=this.formElement.serializeArray();for(iValue=0;iValue<formValues.length;iValue++){var matches,filterName=formValues[iValue].name.substring(12);"[]"==filterName.substring(filterName.length-2)?((filterName=filterName.substring(0,filterName.length-2))in jsonValues||(jsonValues[filterName]=new Array),jsonValues[filterName]instanceof Array?jsonValues[filterName].push(formValues[iValue].value):("values"in jsonValues[filterName]||(jsonValues[filterName].values=new Array),jsonValues[filterName].values.push(formValues[iValue].value))):"[_]"==filterName.substring(filterName.length-3)?((filterName=filterName.substring(0,filterName.length-3))in jsonValues||(jsonValues[filterName]={}),jsonValues[filterName]._=formValues[iValue].value):null!==(matches=filterName.match(/^(.+)\[(.+)\]$/))?(matches[1]in jsonValues||(jsonValues[matches[1]]={}),jsonValues[matches[1]][matches[2]]=formValues[iValue].value):jsonValues[filterName]=formValues[iValue].value}for(k in this.structure)if(this.structure.hasOwnProperty(k)){var fieldData=this.structure[k];switch(fieldData.type){case"radiotree":jsonValues[fieldData.id]._&&!jsonValues[fieldData.id].values&&this.defaultSubValues[fieldData.id]&&this.defaultSubValues[fieldData.id][jsonValues[fieldData.id]._]&&(jsonValues[fieldData.id].values=[this.defaultSubValues[fieldData.id][jsonValues[fieldData.id]._]]);break;case"slider":break;case"dualslider":var sliderValues,slider=$jQ('div.searchFilter[data-filter-id="'+fieldData.id+'"] div.searchFilterField div.searchFilterSlider',this.panelElement);slider.length&&(sliderValues=slider.slider("option","values"),slider.slider("option","min")==sliderValues[0]&&slider.slider("option","max")==sliderValues[1]||(jsonValues[fieldData.id]={left:slider.slider("option","min"),min:sliderValues[0],max:sliderValues[1],right:slider.slider("option","max")}))}}return 0==jsonValues.length&&(jsonValues=null),this.lastFilterQuery=jsonValues},this.updateRangeSliderMin=function(searchFilter,param,min){var max;this.lastInitializedParameters.filters[param]&&((param=this.lastInitializedParameters.filters[param]).useInput?$jQ("div.searchFilterSliderLegendMin input",searchFilter).val(min.values[0]):([min,max]=this.getSliderLegends(param,min.values[0],min.values[1]),$jQ("div.searchFilterSliderLegendMin",searchFilter).text(min)))},this.updateRangeSliderMax=function(searchFilter,param,max){var min;this.lastInitializedParameters.filters[param]&&((param=this.lastInitializedParameters.filters[param]).useInput?$jQ("div.searchFilterSliderLegendMax input",searchFilter).val(max.values[1]):([min,max]=this.getSliderLegends(param,max.values[0],max.values[1]),$jQ("div.searchFilterSliderLegendMax",searchFilter).text(max)))},this.updateRangeSlider=function(searchFilter,filterIndex,ui){this.updateRangeSliderMin(searchFilter,filterIndex,ui),this.updateRangeSliderMax(searchFilter,filterIndex,ui)},this.handleRangleSlider=function(event,ui){var searchFilter=$jQ(ui.handle).closest("div.searchFilterField"),filterId=searchFilter.data("filter-value");if(ui.values[0]==ui.values[1])return!1;this.updateRangeSlider(searchFilter,filterId,ui),searchFilter.addClass("active");var handles=$jQ("a.ui-slider-handle",searchFilter);for(iHandle=0;iHandle<handles.length;iHandle++){var handleLeftOffset=$jQ(handles[iHandle]).css("left");(0==iHandle?$jQ("div.searchFilterSliderLegendMin",searchFilter):$jQ("div.searchFilterSliderLegendMax",searchFilter)).css("left",handleLeftOffset)}},this.handleChangedFilterById=function(filterId,filterValue,filterIndex){this.controllerInstance.searchCallback.directCallback({filterInitiated:!0,triggerFilter:filterId,triggerFilterValue:filterValue,triggerFilterIndex:filterIndex}),this.panelElement.find('a[rel="reset"]').css("visibility","visible"),$jQ(this.controllerInstance).trigger("filterChanged",[])},this.handleChangedFilter=function(event){var filterId=$jQ(event.target).closest("div.searchFilter").data("filter-id");if("radio"==event.target.type||"radiotree"==event.target.type){var filterValue=$jQ(event.target);0!=filterValue.closest("div.searchFilterFieldTreeSubvalues").length||(filter=event.target.name.match(/searchFilter([0-9]+)/))&&(filterId=filter[1],$jQ("div.searchFilterFieldTreeSubvalues","#sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+filterId).remove());for(var filterIndex=$jQ("div.searchFilterField",$jQ(event.target).closest("div.searchFilterValues")).not(filterValue.parents()),radioInputs=$jQ('input[type="radio"]',filterIndex),iInput=0;iInput<radioInputs.length;iInput++)radioInputs.eq(iInput).siblings().removeClass("active")}(0<$jQ(event.target).siblings().length?$jQ(event.target).siblings():$jQ(event.target).closest(".searchFilterField ").find("label, span[data-results]")).toggleClass("active");var filter=this.getFilter(filterId),filterValue=event.target.value,filterIndex=$jQ('[data-filter-id="'+filterId+'"] [data-filter-value]').index($jQ(event.target).closest("[data-filter-value]"));"dualslider"===filter.type&&(filterValue=$jQ(event.target).slider("option","values")),this.handleChangedFilterById(filterId,filterValue,filterIndex)},this.handleQueryFilter=function(event){var labels=$jQ(event.target).siblings("label");labels.length&&this.controllerInstance.setQueryText(labels.first().text()),event.preventDefault()},this.showAllFilters=function(){return this.persistentParameters.filtersShowAll=!0,additionalParameters={filterInitiated:!0,enableFiltersShowAll:!0},this.controllerInstance.searchCallback.directCallback(additionalParameters),!1},this.toggleAllFilterValues=function(filterId,state){return filterId.stopPropagation(),filterId.preventDefault(),(filterId.currentTarget.dataset.filterValue||filterId.currentTarget.rel)&&(filterId=filterId.currentTarget.dataset.filterValue||filterId.currentTarget.rel,state?this.persistentParameters.filterValuesShowAll[filterId]=!0:delete this.persistentParameters.filterValuesShowAll[filterId],additionalParameters={filterInitiated:!0},this.controllerInstance.searchCallback.directCallback(additionalParameters)),!1},this.showAllFilterValues=function(event){return this.toggleAllFilterValues(event,!0)},this.hideAllFilterValues=function(event){return this.toggleAllFilterValues(event,!1)},this.disableOtherSelects=function(){var searchFilter=$jQ(this).closest("div.searchFilter");searchFilter.hasClass("disabled")||(searchFilters=$jQ('div.searchFilterField input[type = "checkbox"]',searchFilter).not(this).prop("checked",!1),$jQ(searchFilters).siblings().removeClass("active"))},this.togglePanel=function(state){this.panelElement.css("visibility",state?"visible":"hidden"),0==state&&(this.filterGroupCache={})},this.updateFilters=function(parameters,queryParameters){for(var hasActiveFilterOptions=!1,newFilters=[],filterKeys=Object.keys(parameters.filters),iFilter=0;iFilter<filterKeys.length;iFilter++)newFilters.push(parseInt(parameters.filters[filterKeys[iFilter]].id));for(iFilter=0;iFilter<Object.keys(this.lastInitializedParameters.filters).length;iFilter++)-1==$jQ.inArray(parseInt(this.lastInitializedParameters.filters[iFilter].id),newFilters)&&(filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+this.lastInitializedParameters.filters[iFilter].id,(filterObject=$jQ("div#"+filterHtmlId)).remove());for(k in parameters.filters)if(parameters.filters.hasOwnProperty(k)){var fieldData=parameters.filters[k],filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+fieldData.id,filterObject=$jQ("div#"+filterHtmlId),filterOptions={};!fieldData.searchable||fieldData.show_all_values||parameters.filterValuesShowAll&&parameters.filterValuesShowAll.hasOwnProperty(fieldData.id)||filterObject.find("[data-search-filter-container]").remove();for(var i=1;null!=parameters.filters[k-i];){var previousFilterHtmlId=parameters.filters[k-i],previousFilterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+previousFilterHtmlId.id;if($jQ("div#"+previousFilterHtmlId).length){filterOptions.previousFilterHtmlId=previousFilterHtmlId;break}i++}if(filterOptions.filterValuesShowAll=parameters.filterValuesShowAll,0!=filterObject.length){switch(fieldData.type){case"manualSorter":case"select":case"mapper":case"multiselect":case"ranges":case"query":case"yesno":case"tree":case"radio":case"radiotree":if(this.controllerInstance.hideEmptyFilters){if(!("values"in fieldData&&0!=fieldData.values.length)){filterObject.hide();continue}filterObject.show()}if("values"in fieldData&&0!=fieldData.values.length&&(hasActiveFilterOptions=!0),null!=parameters.filterValuesShowAll&&void 0!==parameters.filterValuesShowAll[fieldData.id]&&!0===parameters.filterValuesShowAll[fieldData.id]&&(null==this.lastInitializedParameters.filterValuesShowAll||void 0===this.lastInitializedParameters.filterValuesShowAll[fieldData.id])){this.addFilter(k,fieldData,filterObject,filterOptions);continue}var existingFilterObjects=$jQ("div.searchFilterValues > div.searchFilterField",filterObject),existingFilters={};for(iFilter=0;iFilter<existingFilterObjects.length;iFilter++)""!==$jQ(existingFilterObjects[iFilter]).data("filter-value")&&(existingFilters[$jQ(existingFilterObjects[iFilter]).data("filter-value")]=existingFilterObjects[iFilter]);var v,missingValue=!1;for(v in fieldData.values)fieldData.values.hasOwnProperty(v)&&0==(filterField=$jQ('div.searchFilterField[data-filter-value="'+this.parseRel(v)+'"]',filterObject)).length&&(missingValue=!0);if(missingValue){this.addFilter(k,fieldData,filterObject,filterOptions);continue}for(k in fieldData.values)if(fieldData.values.hasOwnProperty(k)){var filterField=$jQ('div.searchFilterField[data-filter-value="'+this.parseRel(k)+'"]',filterObject);if(1==filterField.length)if((filterField=filterField.eq(0)).data("count",fieldData.values[k].c),filterField.removeClass("disabled"),0!=fieldData.values[k].c||"query"==fieldData.type){if(filterField.removeClass("disabled"),"manualSorter"!=fieldData.type&&"mapper"!=fieldData.type&&"radio"!=fieldData.type&&"multiselect"!=fieldData.type||(void 0!==(subvalueContainer=$jQ("input",filterField).attr("disabled"))&&!1!==subvalueContainer&&$jQ("input",filterField).prop("checked",!1),$jQ("input",filterField).removeClass("disabled").prop("disabled",!1)),this.toggleInput($jQ("input",filterField),fieldData,!0),"radio"==fieldData.type&&(fieldData.values[k].a?$jQ("input",filterField).attr("checked","checked").siblings().addClass("active"):$jQ("input",filterField).prop("checked",!1).siblings().removeClass("active")),filterField.children("span[data-results]").html(this.getResultCountString(fieldData.values[k].c)),existingFilters[this.parseRel(k)]=null,"tree"==fieldData.type||"radiotree"==fieldData.type)if(fieldData.subvalues&&fieldData.subvalues[k]&&websight.util.propCount(fieldData.subvalues[k])){var valueId=filterHtmlId+"Value"+k.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),subvalueContainer=$jQ("div.searchFilterFieldTreeSubvalues",filterField);if(0!=subvalueContainer.length)for(var subValues=$jQ('div.searchFilterField[data-filter-value^="'+this.parseRel(k)+'|"]',subvalueContainer),iValue=0;iValue<subValues.length;iValue++){var subRel=subValues.eq(iValue).data("filter-value").split(/\|/);subRel[1]in fieldData.subvalues[k]?($jQ(subValues.eq(iValue)).children("span[data-results]").html(this.getResultCountString(fieldData.subvalues[k][subRel[1]].c)),subValues.eq(iValue).removeClass("disabled"),this.toggleInput($jQ(subValues.eq(iValue)).children("input"),fieldData,!0)):($jQ(subValues.eq(iValue)).children("span[data-results]").html(this.getResultCountString(0)),subValues.eq(iValue).toggleClass("disabled",!0),this.toggleInput($jQ(subValues.eq(iValue)).children("input"),fieldData,!1))}else this.addSubvalues(k,filterField,fieldData,valueId)}else $jQ("div.searchFilterFieldTreeSubvalues",filterField).remove(),filterField.css("height","1.7em").css("overflow","hidden")}else filterField.remove()}if("radio"!=fieldData.type&&"radiotree"!=fieldData.type)for(var k in existingFilters)null!=existingFilters[k]&&$jQ(existingFilters[k]).remove();var realMin=filterObject.find(".searchFilterShowAllValues"),slider=filterObject.find(".searchFilterHideAllValues"),step=filterObject.find("[data-filter-value]");fieldData.show_all_values||fieldData.max_values>=step.length?(realMin.remove(),slider.remove(),step.removeClass("sqr-hidden")):parameters.filterValuesShowAll&&parameters.filterValuesShowAll[fieldData.id]?(realMin.remove(),step.removeClass("sqr-hidden"),slider.length||filterObject.append('<div class="searchFilterHideAllValues"><a href="#" rel="'+fieldData.id+'">'+this.parameters.hideMoreOptionsText+"</a></div>")):(slider.remove(),step.each(function(index){$jQ(this).toggleClass("sqr-hidden",index>=fieldData.max_values)}),realMin.length||filterObject.append('<div class="searchFilterShowAllValues"><a href="#" rel="'+fieldData.id+'">'+this.parameters.moreOptionsText+"</a></div>"));break;case"dualslider":if(this.controllerInstance.hideEmptyFilters){filterObject.toggle(!(fieldData.min==fieldData.max));continue}slider=$jQ('div.searchFilter[data-filter-id="'+fieldData.id+'"] div.searchFilterField div.searchFilterSlider',this.panelElement),step=slider.slider("option","values");(!("filterQuery"in queryParameters)||!(fieldData.id in queryParameters.filterQuery)||step[0]==fieldData.min&&step[1]==fieldData.max||step[0]>queryParameters.filterQuery[fieldData.id].min||step[1]<queryParameters.filterQuery[fieldData.id].max)&&(slider.slider({change:null}),realMin=realMax=left=right=0,realMax=fieldData.id in queryParameters.filterQuery?(left=queryParameters.filterQuery[fieldData.id].left,right=queryParameters.filterQuery[fieldData.id].right,realMin=Math.min(fieldData.min,queryParameters.filterQuery[fieldData.id].min),Math.max(fieldData.max,queryParameters.filterQuery[fieldData.id].max)):(left=realMin=fieldData.min,right=fieldData.max,this.determineSliderMax(left,right,Math.ceil((right-left)/Math.min(right-left,fieldData.steps||50)))),step=Math.ceil((right-left)/Math.min(right-left,fieldData.steps||50)),slider.slider("option","min",left),slider.slider("option","max",this.determineSliderMax(left,right,step)),slider.slider("option","step",step),slider.slider("option","values",[realMin,realMax]),this.updateRangeSlider(filterObject,k,{values:[realMin,realMax]}),slider.slider({change:$jQ.proxy(this.handleChangedFilter,this)}))}0}else filterOptions.animation=!0,this.addFilter(k,fieldData,null,filterOptions)}var versionIE=detectIE();versionIE&&8<=versionIE&&$jQ("html,body").scroll(),hasActiveFilterOptions&&this.panelElement.find('a[rel="reset"]').css("visibility","visible"),this.lastInitializedParameters=parameters},this.determineSliderMax=function(min,quotient,step){var amount=quotient-min,quotient=Math.floor(amount/step);return 0<amount%step&&quotient++,min+quotient*step},this.getResultCountString=function(results){return 4<=this.controllerInstance.indexSettings.view.cssVersion?results:"("+results+")"},this.toggleInput=function(input,fieldData,state){input.off("change").off("click"),state?this.bindChangeEvent(fieldData,input):input.on("click",function(event){return event.preventDefault(),!1}).on("change",function(event){return event.preventDefault(),!1})},this.getFilterGroup=function(groupId){if((groupId=null==groupId?0:groupId)in this.filterGroupCache)return this.filterGroupCache[groupId];var groupConfiguration=null,additionalClasses=1==(groupConfiguration=null==(groupConfiguration=this.controllerInstance.indexSettings.filterGroups?this.controllerInstance.indexSettings.filterGroups[groupId]:groupConfiguration)?{name:"",default_collapsed:!1,collapsible:!1}:groupConfiguration).default_collapsed?" closed":"";additionalClasses+=1==groupConfiguration.collapsible?" collapsible":"";var groupObject=0==groupConfiguration.default_collapsed?"":"display: none;",groupObject=$jQ('<div class="searchFilterGroup'+additionalClasses+'">'+(1==groupConfiguration.collapsible?'<div class="searchFilterGroupToggle"> </div>':"")+(groupConfiguration.name.length?"<h2>"+groupConfiguration.name+"</h2>":"")+'<div class="searchFilterGroupContainer" style="'+groupObject+'"> </div></div>').first();return this.formElement.append(groupObject),this.filterGroupCache[groupId]=groupObject},this.getHeight=function(){return this.panelElement.outerHeight()},this.initialFilterTop=this.panelElement.offset().top,this.lastScrollTop=websight.util.getWindowScrollTop(),this.fixedFiltersCallback=function(){var leftOffset=controllerInstance.container.offset(),scrollingDown=controllerInstance.container.height()+leftOffset.top,isPageAtBottom=$jQ(window).height(),filterHeight=this.panelElement.outerHeight(!0),scrollTop=websight.util.getWindowScrollTop(),dragDown=Math.min(scrollingDown,scrollTop+isPageAtBottom),filterTop=this.panelElement.offset().top,filterBottom=filterTop+filterHeight,fitsInWindow=isPageAtBottom-Math.max(0,scrollTop+isPageAtBottom-scrollingDown),minTop=Math.abs(fitsInWindow-filterHeight),scrolledTop=this.lastScrollTop-scrollTop,scrollingDown=scrollTop>this.lastScrollTop,fitsInWindow=filterHeight<fitsInWindow;controllerInstance.container.css("min-height").replace(/px$/,"")<filterHeight&&controllerInstance.container.css("min-height",filterHeight+"px"),fitsInWindow&&scrollTop>this.initialFilterTop||!fitsInWindow&&scrollTop>this.initialFilterTop+minTop?this.panelElement.hasClass("sqr-fixed")||(this.panelElement.addClass("sqr-fixed").css({position:"fixed"}),this.updatePanelWidth()):!scrollingDown&&scrollTop<=this.initialFilterTop&&(this.panelElement.removeClass("sqr-fixed").css({position:"relative",top:"",left:"",width:""}),this.updatePanelWidth()),this.isFilterpanelFixed=this.panelElement.hasClass("sqr-fixed"),this.isFilterpanelFixed&&((leftOffset=-$jQ(window).scrollLeft()+leftOffset.left)<0?this.panelElement.css("left",leftOffset):this.panelElement.css("left","auto"));dragDown=filterBottom<=dragDown&&scrollingDown;dragDown&&fitsInWindow||scrollTop<=filterTop&&!scrollingDown?this.panelElement.css("top",0):dragDown&&this.isFilterpanelFixed?this.panelElement.css("top",-minTop):this.isFilterpanelFixed&&(minTop=-minTop,scrolledTop=parseInt(this.panelElement.css("top"),10)+scrolledTop,isPageAtBottom=scrollTop+isPageAtBottom>=$jQ(document).height(),this.panelElement.css("top",isPageAtBottom?minTop:scrolledTop)),this.lastScrollTop=scrollTop},this.updatePanelWidth=function(){var resultsMargin;4<=this.controllerInstance.indexSettings.view.cssVersion&&(resultsMargin=this.controllerInstance.searchCallback.resultsPanel.resultContainer.parent().css("margin-left"),this.panelElement.css("width",resultsMargin))},this.handleFilterFloatOnScroll=function(event){0==this.filterFloatInit&&(this.controllerInstance.parameters.filterContainer&&(filtersSelector=this.controllerInstance.parameters.filterContainer),$jQ(window).on("scroll",this.proxiedFunctions.fixedFiltersCallback),this.lastScrollTop=0,this.proxiedFunctions.fixedFiltersCallback(),$jQ(this.controllerInstance).on("updateFilters",$jQ.proxy(function(){this.filterFloatInit&&(this.lastScrollTop=0,this.proxiedFunctions.fixedFiltersCallback())},this)),this.filterFloatInit=!0)},this.disableFilterFloatOnScroll=function(){$jQ(window).off("scroll",this.proxiedFunctions.fixedFiltersCallback),this.filterFloatInit&&(this.panelElement.removeClass("sqr-fixed").css({position:"relative",top:"",left:"",width:""}),this.filterFloatInit=!1)},this.hasFloatingFilters=function(){return"filterFloatOnScroll"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.filterFloatOnScroll&&!websight.util.isTouch()},this.initializePanel=function(parameters){if(!controllerInstance.parameters.tooltip||this.tooltips){for(k in this.hasFloatingFilters()&&(this.filterFloatInit=!1,this.proxiedFunctions.handleFilterFloatOnScroll()),null!=parameters&&(this.parameters=parameters,this.structure=this.parameters.filters),this.panelElement.css("visibility","hidden"),this.panelElement.empty(),this.formElement.empty(),this.filterGroupCache={},this.parameters.html?(url=$jQ(this.parameters.html),this.panelElement.append(url),$jQ("div.filters, div.sqr-filters",this.panelElement).append(this.formElement)):this.panelElement.append(this.formElement),this.structure)this.addFilter(k,this.structure[k]);this.initializeClicks(),this.panelElement.css("visibility","visible"),this.panelElement.find('a[rel="reset"]').on("click",$jQ.proxy(this.controllerInstance.resetFilters,this.controllerInstance)),this.lastInitializedParameters=this.parameters}else{var url=controllerInstance.customServerUrl+controllerInstance.parameters.account.substring(3,controllerInstance.parameters.account.length-2)+"/tooltips.json?domain=localhost";this.fetchTooltips(url,parameters)}},this.fetchTooltips=function(url,parameters){fetch(url).then(response=>response.json()).then(data=>{this.tooltips=data,this.initializePanel(parameters)})},this.clearLastFilterQuery=function(){this.lastFilterQuery=null},this.findMappedValue=function(values,value,type){for(var key in values)if(values[key].value==value&&values[key][type])return values[key][type];return!1},this.addFilter=function(k,fieldData,replaceObject,options){if(null==replaceObject&&(replaceObject=null),null==options&&(options={}),null!=fieldData){var hasActiveOptions=!1;if(!("fixedFilters"in this.controllerInstance.parameters&&(fieldData.id in this.controllerInstance.parameters.fixedFilters||fieldData.code in this.controllerInstance.parameters.fixedFilters))){var sortedValues={};if("object"==typeof fieldData.values&&!Array.isArray(fieldData.values)&&fieldData.values)for(var l in fieldData.values)sortedValues[fieldData.values[l].p]=l;var html=this.getFilterGroup(fieldData.group_id),filterGroupContainer=$jQ("div.searchFilterGroupContainer",html),filterHtml="",filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+fieldData.id,currentValue=null;null!=this.lastFilterQuery&&this.lastFilterQuery[fieldData.id]?currentValue=this.lastFilterQuery[fieldData.id]:this.defaultFilters[fieldData.id]&&(currentValue=this.defaultFilters[fieldData.id]);extraFilterClasses="";var min,tooltipHtml=!1;switch(null!=options.filterValuesShowAll&&fieldData.id in options.filterValuesShowAll&&1==options.filterValuesShowAll[fieldData.id]&&(tooltipHtml=!0),1==fieldData.collapsed&&0==tooltipHtml&&(extraFilterClasses+=" collapsed"),fieldData.type){case"query":if($jQ.isEmptyObject(fieldData.values))filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" data-filter-value="'+this.parseRel(k)+'"><label>Geen filter mogelijkheden</label></div>';else for(var index in sortedValues){var valueId=filterHtmlId+"Value"+(l=sortedValues[index]).replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_");filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" data-filter-value="'+this.parseRel(l)+'"><input type="checkbox" id="'+valueId+'" name="searchFilter'+fieldData.id+'" value="'+l+'" /> <label for="'+valueId+'">'+fieldData.values[l].l+"</label> </div>"}break;case"tree":case"radiotree":case"select":case"yesno":case"radio":if($jQ.isEmptyObject(fieldData.values))filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" data-filter-value="'+this.parseRel(k)+'"><label>Geen filter mogelijkheden</label></div>';else{var checked=!1,widgetType=fieldData.type.match(/^radio/)?"radio":"checkbox",singleOption=!1,number=0;for(index in sortedValues){l=sortedValues[index];if(fieldData.values.hasOwnProperty(l)){number++;var extraLabelClasses=extraSpanClasses="",extraItemClasses=0==fieldData.values[l].c?" disabled":"";switch(inputDisabled=singleOption||0==fieldData.values[l].c?' disabled="disabled"':"",valueMatch=!1,!this.persistentParameters.filterValuesShowAll[fieldData.id]&&!fieldData.show_all_values&&number>fieldData.max_values&&(extraItemClasses+=" sqr-hidden"),fieldData.type){case"tree":case"radiotree":valueMatch=currentValue&&currentValue._==l;break;case"select":null!=currentValue&&(valueMatch=currentValue==l);break;case"radio":case"yesno":valueMatch=fieldData.values[l].a}checked=singleOption||valueMatch,inputDisabled+=checked?' checked="checked"':"",checked&&(extraLabelClasses+=" active",extraSpanClasses+=" active",hasActiveOptions=!0);var valueId=filterHtmlId+"Value"+l.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),fieldHtml="searchFilter"+fieldData.id;"tree"!=fieldData.type&&"radiotree"!=fieldData.type||(fieldHtml+="[_]");fieldHtml='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraItemClasses+'" data-filter-value="'+this.parseRel(l)+'"><input type="'+widgetType+'" '+inputDisabled+' id="'+valueId+'" name="'+fieldHtml+'" value="'+l+'" /> <label for="'+valueId+'" class="'+extraLabelClasses+'">'+fieldData.values[l].l+'</label> <span data-results class="'+extraSpanClasses+'" aria-live="polite">'+this.getResultCountString(fieldData.values[l].c)+"</span></div>";"tree"!=fieldData.type&&"radiotree"!=fieldData.type||fieldData.subvalues&&fieldData.subvalues[l]&&websight.util.propCount(fieldData.subvalues[l])&&(htmlObject=$jQ(fieldHtml).first(),this.addSubvalues(l,htmlObject,fieldData,valueId),fieldHtml=$jQ("<div></div>").append(htmlObject).html()),filterHtml+=fieldHtml}}}break;case"mapper":singleOption=!1,number=0;for(index in sortedValues){k=sortedValues[index];if(fieldData.values.hasOwnProperty(k)){number++;extraLabelClasses=extraSpanClasses="",extraItemClasses=0==fieldData.values[k].c?" disabled":"";inputDisabled=singleOption||0==fieldData.values[k].c?' disabled="disabled"':"",!this.persistentParameters.filterValuesShowAll[fieldData.id]&&!fieldData.show_all_values&&number>fieldData.max_values&&(extraItemClasses+=" sqr-hidden"),valueMatch=fieldData.values[k].a;var checkedStr="";(checked=singleOption||valueMatch)&&(extraLabelClasses+=" active",extraSpanClasses+=" active",checkedStr=' checked="checked"',hasActiveOptions=!0);var valueId=filterHtmlId+"Value"+k.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),title=fieldData.values[k].l.replace(/\<\!\-\-.+\-\-\>/,"");switch(filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraItemClasses+'" data-filter-value="'+this.parseRel(k)+'"><input type="checkbox" '+inputDisabled+checkedStr+' id="'+valueId+'"  name="searchFilter'+fieldData.id+'[]" value="'+k+'" />',fieldData.optionType){case"customImageMapping":case"useValueAsImage":var url="useValueAsImage"==fieldData.optionType?fieldData.values[k].l:this.findMappedValue(fieldData.value_settings,fieldData.values[k].l,"image");url?(filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">',filterHtml+='<img src="'+url+'" alt="'+fieldData.values[k].l+'" /></label> '):(filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">',filterHtml+=fieldData.values[k].l+"</label> ");break;case"customLabelMapping":filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">';var hex=this.findMappedValue(fieldData.value_settings,fieldData.values[k].l,"label");filterHtml+=hex||fieldData.values[k].l,filterHtml+="</label> ";break;case"customHexMapping":case"useValueAsHex":hex="useValueAsHex"==fieldData.optionType?fieldData.values[k].l:this.findMappedValue(fieldData.value_settings,fieldData.values[k].l,"hex");filterHtml+=hex?'<label style="color:'+(hex=-1<hex.indexOf("#")?hex:"#"+hex)+'" for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">':'<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">',filterHtml+=fieldData.values[k].l,filterHtml+="</label> ";break;default:filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">'+fieldData.values[k].l+"</label> "}filterHtml+='<span data-results class="'+extraSpanClasses+'" aria-live="polite">'+this.getResultCountString(fieldData.values[k].c)+"</span></div>"}}break;case"manualSorter":case"multiselect":case"ranges":singleOption=!1,number=0;for(index in sortedValues){k=sortedValues[index];if(fieldData.values.hasOwnProperty(k)){number++;extraLabelClasses=extraSpanClasses="";switch(extraItemClasses=0==fieldData.values[k].c?" disabled":"",inputDisabled=singleOption||0==fieldData.values[k].c?' disabled="disabled"':"",!this.persistentParameters.filterValuesShowAll[fieldData.id]&&!fieldData.show_all_values&&number>fieldData.max_values&&(extraItemClasses+=" sqr-hidden"),fieldData.type){case"manualSorter":case"mapper":case"multiselect":valueMatch=fieldData.values[k].a;break;default:valueMatch=currentValue==k}checkedStr="";(checked=singleOption||valueMatch)&&(extraLabelClasses+=" active",extraSpanClasses+=" active",checkedStr=' checked="checked"',hasActiveOptions=!0);valueId=filterHtmlId+"Value"+k.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),title=fieldData.values[k].l.replace(/\<\!\-\-.+\-\-\>/,"");filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraItemClasses+'" data-filter-value="'+this.parseRel(k)+'"><input type="checkbox" '+inputDisabled+checkedStr+' id="'+valueId+'"  name="searchFilter'+fieldData.id+'[]" value="'+k+'" /> <label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">'+fieldData.values[k].l+'</label> <span data-results class="'+extraSpanClasses+'" aria-live="polite">'+this.getResultCountString(fieldData.values[k].c)+"</span></div>"}}break;case"slider":case"dualslider":null!==(settings=this.getSliderSettings(fieldData))&&([min,distanceUnit]=this.getSliderLegends(fieldData,settings.min,settings.max),filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" data-filter-value="'+this.parseRel(k)+'"><div class="searchFilterSlider"></div><div class="searchFilterSliderLegendMin">'+min+'</div><div class="searchFilterSliderLegendMax">'+distanceUnit+"</div></div>");break;case"location":var distanceUnit="km";"miles"===fieldData.distanceUnits&&(distanceUnit="mi."),filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" data-filter-value="'+this.parseRel(k)+'"><div class="sqr-result-info" onclick="$jQ(this).hide();" id="'+filterHtmlId+'Response"></div><input autocomplete="off" type="text" id="'+filterHtmlId+'Search"/><i class="sqr-location-clear sqr-icon sqr-icon-cancel-circle"></i><input type="hidden" data-location id="'+filterHtmlId+'Location" name="searchFilter'+fieldData.id+'[location]"/><input type="hidden" data-distance id="'+filterHtmlId+'Distance" name="searchFilter'+fieldData.id+'[distance]" value="'+fieldData.defaultDistance+'" /><ul class="sqr-location-suggest" id="'+filterHtmlId+'SuggestValues"><li></li></ul><a href="#" id="'+filterHtmlId+'Geolocate"><i class="sqr-icon sqr-icon-gps"></i> '+this.parameters.locationGetCurrentText+'</a><div class="sqr-distance-label">'+this.parameters.locationDistanceText+' <span class="sqr-distance-value">'+fieldData.defaultDistance+'</span> <span class="sqr-distance-unit">'+distanceUnit+'</span></div> <div class="searchFilterSlider"></div></div>'}if(filterHtml.length){html="";this.controllerInstance.parameters.tooltip&&this.tooltips&&(filterSearchHtml=this.tooltips[fieldData.id]||null,tooltipHtml=this.controllerInstance.parameters.tooltipHtml||"[i]",filterSearchHtml&&(html="click"===this.controllerInstance.parameters.tooltip?'<div class="sqr-tooltip sqr-tooltip-click">'+tooltipHtml+'</div><div class="sqr-tooltip-container"><div class="sqr-tooltip-content"><div class="sqr-tooltip-close">X</div>'+filterSearchHtml+"</div></div>":'<div class="sqr-tooltip sqr-tooltip-hover">'+tooltipHtml+'<div class="sqr-tooltip-container"><div class="sqr-tooltip-content">'+filterSearchHtml+"</div></div></div>"));var filterSearchHtml="";fieldData.searchable&&(fieldData.show_all_values||this.persistentParameters.filterValuesShowAll[fieldData.id])&&(filterSearchHtml='<div data-search-filter-container style="position: relative; margin-bottom: 0.5rem;"><div style="display: flex; position: absolute; bottom: 0; top: 0; left: 0; align-items: center; padding-left: 0.75rem; pointer-events: none;" class="flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"><svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div><input type="search" data-search-filter style="display: block; padding: 0.25rem; padding-left: 2.5rem; width: 100%; font-size: 0.875rem; line-height: 1.25rem; border: solid 1px #C9C9C9;" class="text-gray-900 bg-gray-50 rounded-lg border border-gray-300" placeholder="Search..." required></div>');var tooltipContainer,html='<div class="searchFilter'+extraFilterClasses+'" data-filter-id="'+fieldData.id+'" id="'+filterHtmlId+'"><label aria-expanded="'+!fieldData.collapsed+'" id="'+filterHtmlId+'-label">'+fieldData.label+html+'</label><div class="searchFilterValues" role="group" aria-labelledby="'+filterHtmlId+'-label">'+filterSearchHtml+filterHtml+"</div></div>",htmlObject=$jQ(html);switch(filterSearchHtml&&htmlObject.find("[data-search-filter]").each(function(index,element){element.addEventListener("input",function(){for(var filterFields=element.closest(".searchFilter").querySelectorAll(".searchFilterValues .searchFilterField"),i=0,l=filterFields.length;i<l;i++){var filterField=filterFields[i],shouldBeHidden=-1===filterField.querySelector("label").textContent.toLowerCase().indexOf(element.value.toLowerCase());filterField.style.display=shouldBeHidden?"none":"block"}})}),"click"===this.controllerInstance.parameters.tooltip&&(tooltipContainer=htmlObject.find(".sqr-tooltip-container"),htmlObject.find(".sqr-tooltip-click").on("click",function(e){e.stopPropagation(),tooltipContainer.addClass("sqr-show")}),htmlObject.find(".sqr-tooltip-container .sqr-tooltip-close").on("click",function(e){e.stopPropagation(),tooltipContainer.removeClass("sqr-show")})),fieldData.type){case"manualSorter":case"mapper":case"tree":case"radiotree":case"select":case"radio":case"yesno":case"multiselect":!fieldData.show_all_values&&fieldData.max_values<Object.keys(fieldData.values).length&&(this.persistentParameters.filterValuesShowAll[fieldData.id]?htmlObject.append('<div class="searchFilterHideAllValues"><a href="#" rel="'+fieldData.id+'">'+this.parameters.hideMoreOptionsText+"</a></div>"):htmlObject.append('<div class="searchFilterShowAllValues"><a href="#" rel="'+fieldData.id+'">'+this.parameters.moreOptionsText+"</a></div>"));break;case"dualslider":var $minInput,$maxInput,settings=this.getSliderSettings(fieldData);fieldData.useInput&&null!==settings&&($minInput=$jQ(`<input type="number" value="${settings.min}" min="0" step="${settings.step||1}" />`),$maxInput=$jQ(`<input type="number" value="${settings.max}" min="0" step="${settings.step||1}" />`),$minInput.on("change",e=>{var $slider=htmlObject.find(".searchFilterSlider");$slider.slider("values",0,parseFloat($minInput.val())),this.handleChangedFilter(e),$minInput.val($slider.slider("values",0))}),$maxInput.on("change",e=>{var $slider=htmlObject.find(".searchFilterSlider");$slider.slider("values",1,parseFloat($maxInput.val())),this.handleChangedFilter(e),$maxInput.val($slider.slider("values",1))}),htmlObject.find(".searchFilterSliderLegendMin").empty().append($minInput),htmlObject.find(".searchFilterSliderLegendMax").empty().append($maxInput))}switch(null!=replaceObject?$jQ(replaceObject).replaceWith(htmlObject):null!=options.previousFilterHtmlId&&0<$jQ("div#"+options.previousFilterHtmlId).length?filterGroupContainer.find("div#"+options.previousFilterHtmlId).after(htmlObject):filterGroupContainer.append(htmlObject),"function"==typeof this.getFilter&&!1===this.getFilter(fieldData.id)&&(this.structure[this.structure.length]=fieldData),fieldData.type){case"manualSorter":case"mapper":case"multiselect":case"select":case"query":case"tree":case"yesno":case"ranges":case"radio":case"radiotree":this.bindChangeEvent(fieldData,$jQ("input",htmlObject));break;case"slider":var step=Math.ceil((fieldData.max-fieldData.min)/Math.min(fieldData.max-fieldData.min,fieldData.steps||50));$jQ("div#"+filterHtmlId+" div.searchFilterSlider").attr("value",fieldData.min+";"+fieldData.max),$jQ("div#"+filterHtmlId+" div.searchFilterSlider").slider({min:fieldData.min,max:this.determineSliderMax(fieldData.min,fieldData.max,step),value:fieldData.min,step:step,change:$jQ.proxy(this.handleChangedFilter,this)});break;case"dualslider":var sliderContainer=$jQ("div#"+filterHtmlId+" div.searchFilterSlider");null!==(settings=this.getSliderSettings(fieldData))&&(step=fieldData.step||Math.ceil((settings.right-settings.left)/Math.min(settings.right-settings.left,fieldData.steps||50)),sliderContainer.slider({min:settings.left,max:settings.right,step:step,range:!0,values:[settings.min,settings.max],change:$jQ.proxy(this.handleChangedFilter,this),slide:$jQ.proxy(this.handleRangleSlider,this)}),$jQ("a.ui-slider-handle",sliderContainer).first().addClass("ui-slider-handle-left"),$jQ("a.ui-slider-handle",sliderContainer).last().addClass("ui-slider-handle-right"));break;case"location":var locationInput=htmlObject.find('input[type="text"]');$jQ("a",htmlObject).on("click",$jQ.proxy(function(event){event.preventDefault(),this.getGeolocation(fieldData,htmlObject)},this)),$jQ("ul",htmlObject).on("click","li",$jQ.proxy(function(event){this.handleGeoResultClick(event.currentTarget,locationInput)},this)),this.bindChangeEvent(fieldData,locationInput),$jQ(".sqr-location-clear",htmlObject).on("click",$jQ.proxy(function(event){this.clearGeoFilter(fieldData.id,!0)},this)),$jQ("div#"+filterHtmlId+" div.searchFilterSlider").attr("value",fieldData.defaultDistance),$jQ("div#"+filterHtmlId+" div.searchFilterSlider").slider({min:fieldData.minimumDistance,max:this.determineSliderMax(fieldData.minimumDistance,fieldData.maximumDistance,fieldData.distanceStep),value:fieldData.defaultDistance,step:fieldData.distanceStep,range:"min",change:$jQ.proxy(this.handleChangedFilter,this),slide:$jQ.proxy(function(event,ui){$jQ(event.target).siblings(".sqr-distance-label").find(".sqr-distance-value").text(ui.value),$jQ(event.target).siblings('input[data-distance=""]').val(ui.value)},this)})}this.initializeClicksByFields($jQ("div#"+filterHtmlId))}hasActiveOptions&&this.panelElement.find('a[rel="reset"]').css("visibility","visible")}}},this.getSliderSettings=function(fieldData){if(fieldData.min===fieldData.max)return null;var step=fieldData.step||Math.ceil((fieldData.max-fieldData.min)/Math.min(fieldData.max-fieldData.min,fieldData.steps||50)),settings={"left":fieldData.min,"right":this.determineSliderMax(fieldData.min,fieldData.max,step),"min":fieldData.min,"max":this.determineSliderMax(fieldData.min,fieldData.max,step)};if(null!=this.lastFilterQuery&&fieldData.id in this.lastFilterQuery){var options=["left","right","min","max"];for(name in options)key=options[name],settings[key]=this.lastFilterQuery[fieldData.id][key]}return settings},this.bindChangeEvent=function(fieldData,selector){switch(fieldData.type){case"query":selector.on("change",$jQ.proxy(function(event){this.handleQueryFilter(event)},this));break;case"location":selector.on("keydown",$jQ.proxy(function(event){this.handleLocationSubmit(event,fieldData,selector)},this)),selector.on("keyup",$jQ.proxy(function(event){this.handleLocationInput(event,fieldData,selector)},this));break;case"tree":case"select":case"yesno":selector.on("change",this.disableOtherSelects);case"manualSorter":case"mapper":case"ranges":case"multiselect":case"radio":case"radiotree":selector.on("change",$jQ.proxy(function(event){this.handleChangedFilter(event)},this))}},this.getSliderLegends=function(fieldData,minValue,maxValue){let minArray=[],maxArray=[];return fieldData.layoutPrefix&&(minArray.push(fieldData.layoutPrefix),maxArray.push(fieldData.layoutPrefix)),minArray.push(0==minValue&&fieldData.minLabel?fieldData.minLabel:minValue),maxArray.push(fieldData.hasMaxInt&&fieldData.maxLabel?fieldData.maxLabel:maxValue),fieldData.layoutSuffix&&(minArray.push(fieldData.layoutSuffix),maxArray.push(fieldData.layoutSuffix)),[minArray.join(" "),maxArray.join(" ")]},this.checkSingleOption=function(values){var k,singleOption=!1,resultTotal=0;for(k in values)values[k].c&&(resultTotal+=parseInt(String(values[k].c).replace(/\./,"")));return singleOption=resultTotal==this.parameters.numberOfResults&&1==websight.util.propCount(values)?!0:singleOption},this.showHiddenFilters=function(parameters){for(k in this.parameters=parameters,this.structure=this.parameters.filters,parameters.filters){var fieldData=parameters.filters[k],filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+fieldData.id;0==$jQ("div#"+filterHtmlId).length&&this.addFilter(k,fieldData)}},this.addSubvalues=function(k,filterField,fieldData,valueId){subvalueContainer=$jQ('<div class="searchFilterFieldTreeSubvalues"/>'),subvalueContainer.appendTo(filterField),subvalueContainer=subvalueContainer.first();var currentValue=null;null!=this.lastFilterQuery&&this.lastFilterQuery[fieldData.id].values&&this.lastFilterQuery[fieldData.id]._==k?currentValue=this.lastFilterQuery[fieldData.id].values:this.defaultFilters&&this.defaultFilters[fieldData.id]&&this.defaultFilters[fieldData.id]._==k&&this.defaultFilters[fieldData.id].values&&(currentValue=this.defaultFilters[fieldData.id].values);var l,subValueId,elementType,checked,extraClasses,filterHtml="",iItem=0;for(l in fieldData.subvalues[k])fieldData.subvalues[k].hasOwnProperty(l)&&(subValueId=valueId+"_"+l.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),elementType="radiotree"==fieldData.type?"radio":"checkbox",extraClasses=!1,extraClasses=null==currentValue?0==iItem:currentValue==l,checked="radiotree"==fieldData.type&&extraClasses?' checked="checked"':"",extraClasses="radiotree"==fieldData.type&&extraClasses?"active":"",filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" data-filter-value="'+this.parseRel(k)+"|"+this.parseRel(l)+'"><input type="'+elementType+'" id="'+subValueId+'" name="searchFilter'+fieldData.id+'[]" '+checked+' value="'+l+'" /> <label for="'+subValueId+'" class="'+extraClasses+'">'+fieldData.subvalues[k][l].l+'</label> <span data-results class="'+extraClasses+'" aria-live="polite">'+this.getResultCountString(fieldData.subvalues[k][l].c)+"</span></div>"),iItem++;filterField.css("height","auto").css("overflow","auto"),subvalueContainer.html(filterHtml),$jQ("input",subvalueContainer).on("change",$jQ.proxy(function(event){this.handleChangedFilter(event)},this))},this.toggleFilterGroup=function(doCollapse){var groupObject=$jQ(doCollapse.target).closest("div.searchFilterGroup"),collapsed=$jQ("div.searchFilterGroupContainer div.searchFilter.collapsed",groupObject).length,doCollapse=!0;0<collapsed&&(doCollapse=collapsed<$jQ("div.searchFilterGroupContainer div.searchFilter",groupObject).length),$jQ("div.searchFilterGroupContainer div.searchFilter",groupObject).toggleClass("collapsed",doCollapse),groupObject.toggleClass("collapsed")},this.toggleFilter=function(event){$jQ(event.target).closest("div.searchFilter").toggleClass("collapsed"),event.target.setAttribute("aria-expanded","false"===event.target.getAttribute("aria-expanded"))},this.handleResponsiveResize=function(resultsMargin,newBreakpoint){null!=resultsMargin&&null==newBreakpoint?this.hasFloatingFilters()&&(this.filterFloatInit=!1,this.proxiedFunctions.handleFilterFloatOnScroll()):null==resultsMargin&&null!=newBreakpoint&&this.hasFloatingFilters()&&this.disableFilterFloatOnScroll(),null==resultsMargin&&(resultsMargin=this.controllerInstance.searchCallback.resultsPanel.resultContainer.parent().css("margin-left"),this.panelElement.css("width",resultsMargin))},this.handleOpen=function(){this.hasFloatingFilters()&&(this.filterFloatInit=!1,this.proxiedFunctions.handleFilterFloatOnScroll()),this.updatePanelWidth()},this.handleClose=function(){this.hasFloatingFilters()&&this.disableFilterFloatOnScroll()},this.handleLocationSubmit=function(event,fieldData,inputField){var firstItem=$jQ(inputField).siblings(".sqr-location-suggest"),resultInfoObj=$jQ(inputField).siblings(".sqr-result-info");13==event.keyCode&&(event.preventDefault(),event.stopImmediatePropagation(),firstItem.find("li").is(":visible")&&(firstItem.hide(),resultInfoObj.hide(),firstItem=firstItem.find("li").eq(0),this.handleGeoResultClick(firstItem,inputField)))},this.handleLocationInput=function(event,fieldData,inputField){var self,suggestions=$jQ(inputField).siblings(".sqr-location-suggest"),resultInfoObj=$jQ(inputField).siblings(".sqr-result-info");(65<=event.keyCode||48<=event.keyCode&&event.keyCode<=57||8==event.keyCode||32==event.keyCode||46==event.keyCode||0==event.keyCode)&&(this.handleLocationInputTimeout&&(clearTimeout(this.handleLocationInputTimeout),this.handleLocationInputTimeout=null),0==$jQ(event.target).val().length?(suggestions.hide(),resultInfoObj.hide()):(self=this).handleLocationInputTimeout=setTimeout($jQ.proxy(function(){$jQ.ajax({url:"https://api.sooqr.com/v1/geo/search",jsonp:"callback",dataType:"jsonp",data:{query:$jQ(event.target).val(),country:fieldData.countries,group:"city",results:10},success:function(response){if(response.results&&response.results.length){for(var k in suggestions.empty(),response.results)suggestions.append('<li data-latitude="'+response.results[k].latitude+'" data-longitude="'+response.results[k].longitude+'"><a>'+response.results[k].name+", "+response.results[k].countrycode+" ("+response.results[k].postalcode+")</a></li>");suggestions.show(),resultInfoObj.hide()}else suggestions.hide(),self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText)},error:function(response){self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText)}})},this),200))},this.toggleGeoFieldReadonly=function(inputField,state){inputField.attr("readonly",!!state&&"readonly"),inputField.toggleClass("sqr-readonly",state)},this.handleGeoResultClick=function(item,filterId){item=$jQ(item),filterId.val(item.text()),this.toggleGeoFieldReadonly(filterId,!0),filterId.siblings('input[data-location=""]').val(item.data("latitude")+","+item.data("longitude")),filterId.siblings("ul").hide(),filterId.siblings(".sqr-location-clear").show();filterId=$jQ(filterId).closest("div.searchFilter").data("filter-id");this.handleChangedFilterById(filterId)},this.getGeolocation=function(filterObject,htmlObject){var resultInfoObj=htmlObject.find(".sqr-result-info");navigator.geolocation?navigator.geolocation.getCurrentPosition($jQ.proxy(function(position){var self=this;$jQ.ajax({url:"https://api.sooqr.com/v1/geo/near",jsonp:"callback",dataType:"jsonp",data:{lat:position.coords.latitude,lng:position.coords.longitude,country:filterObject.countries,results:1},success:function(dummyItem){var inputField=$jQ("input",htmlObject);dummyItem.results&&dummyItem.results.length?(dummyItem=$jQ('<li data-latitude="'+dummyItem.results[0].latitude+'" data-longitude="'+dummyItem.results[0].longitude+'"><a>'+dummyItem.results[0].name+", "+dummyItem.results[0].countrycode+" ("+dummyItem.results[0].postalcode+")</a></li>"),self.handleGeoResultClick(dummyItem,htmlObject.find('input[type="text"]')),self.processGeoResultInfo(resultInfoObj,self.parameters.locationFoundText)):(self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText),self.toggleGeoFieldReadonly(inputField,!1))},error:function(response){self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText)}})},this)):this.processGeoResultInfo(resultInfoObj,this.parameters.locationNotSupportedText)},this.processGeoResultInfo=function(resultInfoObj,resultInfo){resultInfo&&resultInfoObj.text(resultInfo).fadeIn(400,function(){setTimeout(function(){resultInfoObj.fadeOut()},5e3)})},this.getFilter=function(filterId){for(k in this.structure)if(this.structure.hasOwnProperty(k)&&this.structure[k].id==filterId)return this.structure[k];return!1},this.getFilterType=function(filter){filter=this.getFilter(filter);return!1!==filter&&filter.type},this.clearGeoFilter=function(filterId,refresh){var htmlObject=$jQ('div[data-filter-id="'+filterId+'"]',this.panelElement);$jQ(htmlObject).find(".sqr-result-info").hide(),$jQ(htmlObject).siblings(".sqr-location-suggest").hide(),$jQ(htmlObject).find('input[type="text"], input[data-location=""]').val(""),$jQ(htmlObject).find(".sqr-location-clear").hide(),this.toggleGeoFieldReadonly(htmlObject.find('input[type="text"]'),!1),refresh&&this.handleChangedFilterById(filterId)},this.proxiedFunctions={handleFilterFloatOnScroll:$jQ.proxy(this.handleFilterFloatOnScroll,this),fixedFiltersCallback:$jQ.proxy(this.fixedFiltersCallback,this),handleOpen:$jQ.proxy(this.handleOpen,this),handleClose:$jQ.proxy(this.handleClose,this)},this.initializeClicks=function(){var moreFiltersBlock;$jQ("div.searchFilterGroup.collapsible h2, div.searchFilterGroup div.searchFilterGroupToggle",this.formElement).on("click",$jQ.proxy(function(event){this.toggleFilterGroup(event),event.stopPropagation()},this)),this.parameters.hasHiddenFilters&&(moreFiltersBlock=$jQ('<div class="searchFilterShowAllFilters"><a href="#">Toon alle filters</a></div>'),this.panelElement.append(moreFiltersBlock),$jQ("a",moreFiltersBlock).on("click",$jQ.proxy(this.showAllFilters,this)))},this.initializeClicksByFields=function(fields){return $jQ("label:first",fields).on("click",$jQ.proxy(function(event){this.toggleFilter(event),event.stopPropagation()},this)),$jQ(fields).on("click","div.searchFilterShowAllValues a",$jQ.proxy(function(event){return this.showAllFilterValues(event)},this)),$jQ(fields).on("click","div.searchFilterHideAllValues a",$jQ.proxy(function(event){return this.hideAllFilterValues(event)},this)),fields},this.parseRel=function(rel){return rel.replace("\x3c!--","commentStart").replace("--\x3e","commentEnd").replace("/","").replace('"',"doublequote")},$jQ(this.controllerInstance).on("open",this.proxiedFunctions.handleOpen),$jQ(this.controllerInstance).on("close",this.proxiedFunctions.handleClose),this.initializePanel()},function($){$.ui=$.ui||{};$.ui.version="1.12.1";var orig,widgetUuid=0,widgetSlice=Array.prototype.slice;$.cleanData=(orig=$.cleanData,function(elems){for(var events,elem,i=0;null!=(elem=elems[i]);i++)try{(events=$._data(elem,"events"))&&events.remove&&$(elem).triggerHandler("remove")}catch(e){}orig(elems)}),$.widget=function(name,base,prototype){var existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0],fullName=namespace+"-"+(name=name.split(".")[1]);return prototype||(prototype=base,base=$.Widget),$.isArray(prototype)&&(prototype=$.extend.apply(null,[{}].concat(prototype))),$.expr.pseudos[fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)},$[namespace]=$[namespace]||{},existingConstructor=$[namespace][name],constructor=$[namespace][name]=function(options,element){if(!this._createWidget)return new constructor(options,element);arguments.length&&this._createWidget(options,element)},$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]}),(basePrototype=new base).options=$.widget.extend({},basePrototype.options),$.each(prototype,function(prop,value){function _super(){return base.prototype[prop].apply(this,arguments)}function _superApply(args){return base.prototype[prop].apply(this,args)}$.isFunction(value)?proxiedPrototype[prop]=function(){var returnValue,__super=this._super,__superApply=this._superApply;return this._super=_super,this._superApply=_superApply,returnValue=value.apply(this,arguments),this._super=__super,this._superApply=__superApply,returnValue}:proxiedPrototype[prop]=value}),constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor&&basePrototype.widgetEventPrefix||name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName}),existingConstructor?($.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)}),delete existingConstructor._childConstructors):base._childConstructors.push(constructor),$.widget.bridge(name,constructor),constructor},$.widget.extend=function(target){for(var key,value,input=widgetSlice.call(arguments,1),inputIndex=0,inputLength=input.length;inputIndex<inputLength;inputIndex++)for(key in input[inputIndex])value=input[inputIndex][key],input[inputIndex].hasOwnProperty(key)&&void 0!==value&&($.isPlainObject(value)?target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):target[key]=value);return target},$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=widgetSlice.call(arguments,1),returnValue=this;return isMethodCall?this.length||"instance"!==options?this.each(function(){var methodValue,instance=$.data(this,fullName);return"instance"===options?(returnValue=instance,!1):instance?$.isFunction(instance[options])&&"_"!==options.charAt(0)?(methodValue=instance[options].apply(instance,args))!==instance&&void 0!==methodValue?(returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue,!1):void 0:$.error("no such method '"+options+"' for "+name+" widget instance"):$.error("cannot call methods on "+name+" prior to initialization; attempted to call method '"+options+"'")}):returnValue=void 0:(args.length&&(options=$.widget.extend.apply(null,[options].concat(args))),this.each(function(){var instance=$.data(this,fullName);instance?(instance.option(options||{}),instance._init&&instance._init()):$.data(this,fullName,new object(options,this))})),returnValue}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0],this.element=$(element),this.uuid=widgetUuid++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=$(),this.hoverable=$(),this.focusable=$(),this.classesElementLookup={},element!==this&&($.data(element,this.widgetFullName,this),this._on(!0,this.element,{remove:function(event){event.target===element&&this.destroy()}}),this.document=$(element.style?element.ownerDocument:element.document||element),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this.options=$.widget.extend({},this.options,this._getCreateOptions(),options),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){var that=this;this._destroy(),$.each(this.classesElementLookup,function(key,value){that._removeClass(value,key)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).prop("aria-disabled",!1),this.bindings.off(this.eventNamespace)},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var parts,curOption,i,options=key;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof key)if(options={},key=(parts=key.split(".")).shift(),parts.length){for(curOption=options[key]=$.widget.extend({},this.options[key]),i=0;i<parts.length-1;i++)curOption[parts[i]]=curOption[parts[i]]||{},curOption=curOption[parts[i]];if(key=parts.pop(),1===arguments.length)return void 0===curOption[key]?null:curOption[key];curOption[key]=value}else{if(1===arguments.length)return void 0===this.options[key]?null:this.options[key];options[key]=value}return this._setOptions(options),this},_setOptions:function(options){for(var key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){return"classes"===key&&this._setOptionClasses(value),this.options[key]=value,"disabled"===key&&this._setOptionDisabled(value),this},_setOptionClasses:function(value){var classKey,elements,currentElements;for(classKey in value)currentElements=this.classesElementLookup[classKey],value[classKey]!==this.options.classes[classKey]&&currentElements&&currentElements.length&&(elements=$(currentElements.get()),this._removeClass(currentElements,classKey),elements.addClass(this._classes({element:elements,keys:classKey,classes:value,add:!0})))},_setOptionDisabled:function(value){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!value),value&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(options){var full=[],that=this;function processClassString(classes,checkOption){for(var current,i=0;i<classes.length;i++)current=that.classesElementLookup[classes[i]]||$(),current=options.add?$($.uniqueSort(current.get().concat(options.element.get()))):$(current.not(options.element).get()),that.classesElementLookup[classes[i]]=current,full.push(classes[i]),checkOption&&options.classes[classes[i]]&&full.push(options.classes[classes[i]])}return options=$.extend({element:this.element,classes:this.options.classes||{}},options),this._on(options.element,{"remove":"_untrackClassesElement"}),options.keys&&processClassString(options.keys.match(/\S+/g)||[],!0),options.extra&&processClassString(options.extra.match(/\S+/g)||[]),full.join(" ")},_untrackClassesElement:function(event){var that=this;$.each(that.classesElementLookup,function(key,value){-1!==$.inArray(event.target,value)&&(that.classesElementLookup[key]=$(value.not(event.target).get()))})},_removeClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,!1)},_addClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,!0)},_toggleClass:function(element,keys,options,add){var shift="string"==typeof element||null===element,options={extra:shift?keys:options,keys:shift?element:keys,element:shift?this.element:element,add:add="boolean"==typeof add?add:options};return options.element.toggleClass(this._classes(options),add),this},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;"boolean"!=typeof suppressDisabledCheck&&(handlers=element,element=suppressDisabledCheck,suppressDisabledCheck=!1),handlers?(element=delegateElement=$(element),this.bindings=this.bindings.add(element)):(handlers=element,element=this.element,delegateElement=this.widget()),$.each(handlers,function(eventName,handler){function handlerProxy(){if(suppressDisabledCheck||!0!==instance.options.disabled&&!$(this).hasClass("ui-state-disabled"))return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}"string"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var selector=eventName.match(/^([\w:-]*)\s*(.*)$/),eventName=selector[1]+instance.eventNamespace,selector=selector[2];selector?delegateElement.on(eventName,selector,handlerProxy):element.on(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,element.off(eventName).off(eventName),this.bindings=$(this.bindings.not(element).get()),this.focusable=$(this.focusable.not(element).get()),this.hoverable=$(this.hoverable.not(element).get())},_delay:function(handler,delay){var instance=this;return setTimeout(function(){return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)},delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element),this._on(element,{mouseenter:function(event){this._addClass($(event.currentTarget),null,"ui-state-hover")},mouseleave:function(event){this._removeClass($(event.currentTarget),null,"ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element),this._on(element,{focusin:function(event){this._addClass($(event.currentTarget),null,"ui-state-focus")},focusout:function(event){this._removeClass($(event.currentTarget),null,"ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];if(data=data||{},(event=$.Event(event)).type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),event.target=this.element[0],orig=event.originalEvent)for(prop in orig)prop in event||(event[prop]=orig[prop]);return this.element.trigger(event,data),!($.isFunction(callback)&&!1===callback.apply(this.element[0],[event].concat(data))||event.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){var effectName=(options="string"==typeof options?{effect:options}:options)?!0!==options&&"number"!=typeof options&&options.effect||defaultEffect:method,hasOptions=!$.isEmptyObject(options="number"==typeof(options=options||{})?{duration:options}:options);options.complete=callback,options.delay&&element.delay(options.delay),hasOptions&&$.effects&&$.effects.effect[effectName]?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method](),callback&&callback.call(element[0]),next()})}});var cachedScrollbarWidth,max,abs,rhorizontal,rvertical,roffset,rposition,rpercent,_position;$.widget;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)]}function parseCss(element,property){return parseInt($.css(element,property),10)||0}$jQ,max=Math.max,abs=Math.abs,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position,$.position={scrollbarWidth:function(){if(void 0!==cachedScrollbarWidth)return cachedScrollbarWidth;var w1,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),w2=div.children()[0];return $("body").append(div),w1=w2.offsetWidth,div.css("overflow","scroll"),w1===(w2=w2.offsetWidth)&&(w2=div[0].clientWidth),div.remove(),cachedScrollbarWidth=w1-w2},getScrollInfo:function(within){var hasOverflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX="scroll"===hasOverflowX||"auto"===hasOverflowX&&within.width<within.element[0].scrollWidth;return{width:"scroll"===overflowY||"auto"===overflowY&&within.height<within.element[0].scrollHeight?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0}},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&9===withinElement[0].nodeType;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:!isWindow&&!isDocument?$(element).offset():{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:withinElement.outerWidth(),height:withinElement.outerHeight()}}},$.fn.position=function(options){if(!options||!options.of)return _position.apply(this,arguments);options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,raw,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={},dimensions=9===(raw=(dimensions=target)[0]).nodeType?{width:dimensions.width(),height:dimensions.height(),offset:{top:0,left:0}}:$.isWindow(raw)?{width:dimensions.width(),height:dimensions.height(),offset:{top:dimensions.scrollTop(),left:dimensions.scrollLeft()}}:raw.preventDefault?{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}}:{width:dimensions.outerWidth(),height:dimensions.outerHeight(),offset:dimensions.offset()};return target[0].preventDefault&&(options.at="left top"),targetWidth=dimensions.width,targetHeight=dimensions.height,basePosition=$.extend({},targetOffset=dimensions.offset),$.each(["my","at"],function(){var horizontalOffset,verticalOffset,pos=(options[this]||"").split(" ");(pos=1===pos.length?rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"]:pos)[0]=rhorizontal.test(pos[0])?pos[0]:"center",pos[1]=rvertical.test(pos[1])?pos[1]:"center",horizontalOffset=roffset.exec(pos[0]),verticalOffset=roffset.exec(pos[1]),offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0],options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]]}),1===collision.length&&(collision[1]=collision[0]),"right"===options.at[0]?basePosition.left+=targetWidth:"center"===options.at[0]&&(basePosition.left+=targetWidth/2),"bottom"===options.at[1]?basePosition.top+=targetHeight:"center"===options.at[1]&&(basePosition.top+=targetHeight/2),atOffset=getOffsets(offsets.at,targetWidth,targetHeight),basePosition.left+=atOffset[0],basePosition.top+=atOffset[1],this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());"right"===options.my[0]?position.left-=elemWidth:"center"===options.my[0]&&(position.left-=elemWidth/2),"bottom"===options.my[1]?position.top-=elemHeight:"center"===options.my[1]&&(position.top-=elemHeight/2),position.left+=myOffset[0],position.top+=myOffset[1],collisionPosition={marginLeft:marginLeft,marginTop:marginTop},$.each(["left","top"],function(i,dir){$.ui.position[collision[i]]&&$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem})}),options.using&&(using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":0<left?"right":"center",vertical:bottom<0?"top":0<top?"bottom":"middle"};targetWidth<elemWidth&&abs(left+right)<targetWidth&&(feedback.horizontal="center"),targetHeight<elemHeight&&abs(top+bottom)<targetHeight&&(feedback.vertical="middle"),max(abs(left),abs(right))>max(abs(top),abs(bottom))?feedback.important="horizontal":feedback.important="vertical",options.using.call(this,props,feedback)}),elem.offset($.extend(position,{using:using}))})},$.ui.position={fit:{left:function(position,data){var newOverRight=data.within,withinOffset=newOverRight.isWindow?newOverRight.scrollLeft:newOverRight.offset.left,outerWidth=newOverRight.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset;data.collisionWidth>outerWidth?0<overLeft&&overRight<=0?(newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset,position.left+=overLeft-newOverRight):position.left=!(0<overRight&&overLeft<=0)&&overRight<overLeft?withinOffset+outerWidth-data.collisionWidth:withinOffset:0<overLeft?position.left+=overLeft:0<overRight?position.left-=overRight:position.left=max(position.left-collisionPosLeft,position.left)},top:function(position,data){var newOverBottom=data.within,withinOffset=newOverBottom.isWindow?newOverBottom.scrollTop:newOverBottom.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset;data.collisionHeight>outerHeight?0<overTop&&overBottom<=0?(newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset,position.top+=overTop-newOverBottom):position.top=!(0<overBottom&&overTop<=0)&&overBottom<overTop?withinOffset+outerHeight-data.collisionHeight:withinOffset:0<overTop?position.top+=overTop:0<overBottom?position.top-=overBottom:position.top=max(position.top-collisionPosTop,position.top)}},flip:{left:function(position,data){var atOffset=data.within,newOverRight=atOffset.offset.left+atOffset.scrollLeft,outerWidth=atOffset.width,newOverLeft=atOffset.isWindow?atOffset.scrollLeft:atOffset.offset.left,offset=position.left-data.collisionPosition.marginLeft,overLeft=offset-newOverLeft,overRight=offset+data.collisionWidth-outerWidth-newOverLeft,myOffset="left"===data.my[0]?-data.elemWidth:"right"===data.my[0]?data.elemWidth:0,atOffset="left"===data.at[0]?data.targetWidth:"right"===data.at[0]?-data.targetWidth:0,offset=-2*data.offset[0];overLeft<0?((newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-newOverRight)<0||newOverRight<abs(overLeft))&&(position.left+=myOffset+atOffset+offset):0<overRight&&(0<(newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-newOverLeft)||abs(newOverLeft)<overRight)&&(position.left+=myOffset+atOffset+offset)},top:function(position,data){var atOffset=data.within,newOverBottom=atOffset.offset.top+atOffset.scrollTop,outerHeight=atOffset.height,newOverTop=atOffset.isWindow?atOffset.scrollTop:atOffset.offset.top,offset=position.top-data.collisionPosition.marginTop,overTop=offset-newOverTop,overBottom=offset+data.collisionHeight-outerHeight-newOverTop,myOffset="top"===data.my[1]?-data.elemHeight:"bottom"===data.my[1]?data.elemHeight:0,atOffset="top"===data.at[1]?data.targetHeight:"bottom"===data.at[1]?-data.targetHeight:0,offset=-2*data.offset[1];overTop<0?((newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-newOverBottom)<0||newOverBottom<abs(overTop))&&(position.top+=myOffset+atOffset+offset):0<overBottom&&(0<(newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-newOverTop)||abs(newOverTop)<overBottom)&&(position.top+=myOffset+atOffset+offset)}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments),$.ui.position.fit.left.apply(this,arguments)},top:function(){$.ui.position.flip.top.apply(this,arguments),$.ui.position.fit.top.apply(this,arguments)}}};$.ui.position;"1.7"===$.fn.jquery.substring(0,3)&&($.each(["Width","Height"],function(i,name){var side="Width"===name?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0,border&&(size-=parseFloat($.css(elem,"border"+this+"Width"))||0),margin&&(size-=parseFloat($.css(elem,"margin"+this))||0)}),size}$.fn["inner"+name]=function(size){return void 0===size?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})},$.fn["outer"+name]=function(size,margin){return"number"!=typeof size?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}}),$.fn.addBack=function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))});$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var mouseHandled=!1;$(document).on("mouseup",function(){mouseHandled=!1});$.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.on("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).on("click."+this.widgetName,function(event){if(!0===$.data(event.target,that.widgetName+".preventClickEvent"))return $.removeData(event.target,that.widgetName+".preventClickEvent"),event.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(event){if(!mouseHandled){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(event),this._mouseDownEvent=event;var that=this,btnIsLeft=1===event.which,elIsCancel=!("string"!=typeof this.options.cancel||!event.target.nodeName)&&$(event.target).closest(this.options.cancel).length;return btnIsLeft&&!elIsCancel&&this._mouseCapture(event)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=!1!==this._mouseStart(event),!this._mouseStarted)?(event.preventDefault(),!0):(!0===$.data(event.target,this.widgetName+".preventClickEvent")&&$.removeData(event.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(event){return that._mouseMove(event)},this._mouseUpDelegate=function(event){return that._mouseUp(event)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),event.preventDefault(),mouseHandled=!0)):!0}},_mouseMove:function(event){if(this._mouseMoved){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button)return this._mouseUp(event);if(!event.which)if(event.originalEvent.altKey||event.originalEvent.ctrlKey||event.originalEvent.metaKey||event.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(event)}return(event.which||event.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(event),event.preventDefault()):(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,event),this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)),!this._mouseStarted)},_mouseUp:function(event){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,event.target===this._mouseDownEvent.target&&$.data(event.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(event)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,mouseHandled=!1,event.preventDefault()},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(set&&(allowDisconnected||instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType))for(i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}},$.ui.safeBlur=function(element){element&&"body"!==element.nodeName.toLowerCase()&&$(element).trigger("blur")},$.widget("ui.slider",$.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var i,options=this.options,existingHandles=this.element.find(".ui-slider-handle"),handles=[],handleCount=options.values&&options.values.length||1;for(existingHandles.length>handleCount&&(existingHandles.slice(handleCount).remove(),existingHandles=existingHandles.slice(0,handleCount)),i=existingHandles.length;i<handleCount;i++)handles.push("<span tabindex='0'></span>");this.handles=existingHandles.add($(handles.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(i){$(this).data("ui-slider-handle-index",i).attr("tabIndex",0)})},_createRange:function(){var options=this.options;options.range?(!0===options.range&&(options.values?options.values.length&&2!==options.values.length?options.values=[options.values[0],options.values[0]]:$.isArray(options.values)&&(options.values=options.values.slice(0)):options.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({"left":"","bottom":""})):(this.range=$("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),"min"!==options.range&&"max"!==options.range||this._addClass(this.range,"ui-slider-range-"+options.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(event){var normValue,distance,closestHandle,index,offset,mouseOverHandle,that=this,o=this.options;return!o.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),mouseOverHandle={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(mouseOverHandle),distance=this._valueMax()-this._valueMin()+1,this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));(thisDistance<distance||distance===thisDistance&&(i===that._lastChangedValue||that.values(i)===o.min))&&(distance=thisDistance,closestHandle=$(this),index=i)}),!1!==this._start(event,index)&&(this._mouseSliding=!0,this._handleIndex=index,this._addClass(closestHandle,null,"ui-state-active"),closestHandle.trigger("focus"),offset=closestHandle.offset(),mouseOverHandle=!$(event.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-closestHandle.width()/2,top:event.pageY-offset.top-closestHandle.height()/2-(parseInt(closestHandle.css("borderTopWidth"),10)||0)-(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+(parseInt(closestHandle.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(event,index,normValue),this._animateOff=!0))},_mouseStart:function(){return!0},_mouseDrag:function(event){var normValue={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(normValue);return this._slide(event,this._handleIndex,normValue),!1},_mouseStop:function(event){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(event,this._handleIndex),this._change(event,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(percentMouse){var valueMouse,percentMouse="horizontal"===this.orientation?(valueMouse=this.elementSize.width,percentMouse.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(valueMouse=this.elementSize.height,percentMouse.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),percentMouse=percentMouse/valueMouse;return(percentMouse=1<percentMouse?1:percentMouse)<0&&(percentMouse=0),"vertical"===this.orientation&&(percentMouse=1-percentMouse),valueMouse=this._valueMax()-this._valueMin(),valueMouse=this._valueMin()+percentMouse*valueMouse,this._trimAlignValue(valueMouse)},_uiHash:function(index,value,values){var uiHash={handle:this.handles[index],handleIndex:index,value:void 0!==value?value:this.value()};return this._hasMultipleValues()&&(uiHash.value=void 0!==value?value:this.values(index),uiHash.values=values||this.values()),uiHash},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(event,index){return this._trigger("start",event,this._uiHash(index))},_slide:function(event,index,newVal){var otherVal,currentValue=this.value(),newValues=this.values();this._hasMultipleValues()&&(otherVal=this.values(index?0:1),currentValue=this.values(index),2===this.options.values.length&&!0===this.options.range&&(newVal=0===index?Math.min(otherVal,newVal):Math.max(otherVal,newVal)),newValues[index]=newVal),newVal!==currentValue&&!1!==this._trigger("slide",event,this._uiHash(index,newVal,newValues))&&(this._hasMultipleValues()?this.values(index,newVal):this.value(newVal))},_stop:function(event,index){this._trigger("stop",event,this._uiHash(index))},_change:function(event,index){this._keySliding||this._mouseSliding||(this._lastChangedValue=index,this._trigger("change",event,this._uiHash(index)))},value:function(newValue){return arguments.length?(this.options.value=this._trimAlignValue(newValue),this._refreshValue(),void this._change(null,0)):this._value()},values:function(index,newValue){var vals,newValues,i;if(1<arguments.length)return this.options.values[index]=this._trimAlignValue(newValue),this._refreshValue(),void this._change(null,index);if(!arguments.length)return this._values();if(!$.isArray(index))return this._hasMultipleValues()?this._values(index):this.value();for(vals=this.options.values,newValues=index,i=0;i<vals.length;i+=1)vals[i]=this._trimAlignValue(newValues[i]),this._change(null,i);this._refreshValue()},_setOption:function(key,value){var i,valsLength=0;switch("range"===key&&!0===this.options.range&&("min"===value?(this.options.value=this._values(0),this.options.values=null):"max"===value&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),$.isArray(this.options.values)&&(valsLength=this.options.values.length),this._super(key,value),key){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(value),this.handles.css("horizontal"===value?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),i=valsLength-1;0<=i;i--)this._change(null,i);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(value){this._super(value),this._toggleClass(null,"ui-state-disabled",!!value)},_value:function(){var val=this.options.value;return val=this._trimAlignValue(val)},_values:function(index){var val,vals,i;if(arguments.length)return val=this.options.values[index],this._trimAlignValue(val);if(this._hasMultipleValues()){for(vals=this.options.values.slice(),i=0;i<vals.length;i+=1)vals[i]=this._trimAlignValue(vals[i]);return vals}return[]},_trimAlignValue:function(alignValue){if(alignValue<=this._valueMin())return this._valueMin();if(alignValue>=this._valueMax())return this._valueMax();var step=0<this.options.step?this.options.step:1,valModStep=(alignValue-this._valueMin())%step,alignValue=alignValue-valModStep;return 2*Math.abs(valModStep)>=step&&(alignValue+=0<valModStep?step:-step),parseFloat(alignValue.toFixed(5))},_calculateNewMax:function(){var max=Number(this.options.max),min=Number(this._valueMin()),step=this.options.step;(max=Math.round((max-min)/step)*step+min)>this.options.max&&(max-=step),this.max=parseFloat(max.toFixed(this._precision()))},_precision:function(){var precision=this._precisionOf(this.options.step);return precision=null!==this.options.min?Math.max(precision,this._precisionOf(this.options.min)):precision},_precisionOf:function(decimal){var str=decimal.toString(),decimal=str.indexOf(".");return-1===decimal?0:str.length-decimal-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(orientation){"vertical"===orientation&&this.range.css({"width":"","left":""}),"horizontal"===orientation&&this.range.css({"height":"","bottom":""})},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=!this._animateOff&&o.animate,_set={};this._hasMultipleValues()?this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-that._valueMin())*100,_set["horizontal"===that.orientation?"left":"bottom"]=valPercent+"%",$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate),!0===that.options.range&&("horizontal"===that.orientation?(0===i&&that.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate),1===i&&that.range[animate?"animate":"css"]({width:valPercent-lastValPercent+"%"},{queue:!1,duration:o.animate})):(0===i&&that.range.stop(1,1)[animate?"animate":"css"]({bottom:valPercent+"%"},o.animate),1===i&&that.range[animate?"animate":"css"]({height:valPercent-lastValPercent+"%"},{queue:!1,duration:o.animate}))),lastValPercent=valPercent}):(value=this.value(),valueMin=this._valueMin(),valueMax=this._valueMax(),valPercent=valueMax!==valueMin?(value-valueMin)/(valueMax-valueMin)*100:0,_set["horizontal"===this.orientation?"left":"bottom"]=valPercent+"%",this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate),"min"===oRange&&"horizontal"===this.orientation&&this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate),"max"===oRange&&"horizontal"===this.orientation&&this.range.stop(1,1)[animate?"animate":"css"]({width:100-valPercent+"%"},o.animate),"min"===oRange&&"vertical"===this.orientation&&this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate),"max"===oRange&&"vertical"===this.orientation&&this.range.stop(1,1)[animate?"animate":"css"]({height:100-valPercent+"%"},o.animate))},_handleEvents:{keydown:function(event){var curVal,newVal,step,index=$(event.target).data("ui-slider-handle-index");switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(event.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass($(event.target),null,"ui-state-active"),!1===this._start(event,index)))return}switch(step=this.options.step,curVal=newVal=this._hasMultipleValues()?this.values(index):this.value(),event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+(this._valueMax()-this._valueMin())/this.numPages);break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-(this._valueMax()-this._valueMin())/this.numPages);break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax())return;newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin())return;newVal=this._trimAlignValue(curVal-step)}this._slide(event,index,newVal)},keyup:function(event){var index=$(event.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(event,index),this._change(event,index),this._removeClass($(event.target),null,"ui-state-active"))}}});!function(){"use strict";!function($){$.fn._fadeIn=$.fn.fadeIn;var noOp=$.noop||function(){},msie=/MSIE/.test(navigator.userAgent),ie6=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent),setExpr=(document.documentMode,$.isFunction(document.createElement("div").style.setExpression));$.blockUI=function(opts){install(window,opts)},$.unblockUI=function(opts){remove(window,opts)},$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');title&&$m.append("<h1>"+title+"</h1>"),message&&$m.append("<h2>"+message+"</h2>"),void 0===timeout&&(timeout=3e3);function callBlock(opts){$.blockUI({message:$m,fadeIn:void 0!==(opts=opts||{}).fadeIn?opts.fadeIn:700,fadeOut:void 0!==opts.fadeOut?opts.fadeOut:1e3,timeout:void 0!==opts.timeout?opts.timeout:timeout,centerY:!1,showOverlay:!1,onUnblock:onClose,css:$.blockUI.defaults.growlCSS})}callBlock();$m.css("opacity");$m.mouseover(function(){callBlock({fadeIn:0,timeout:3e4});var displayBlock=$(".blockMsg");displayBlock.stop(),displayBlock.fadeTo(300,1)}).mouseout(function(){$(".blockMsg").fadeOut(1e3)})},$.fn.block=function(opts){if(this[0]===window)return $.blockUI(opts),this;var fullOpts=$.extend({},$.blockUI.defaults,opts||{});return this.each(function(){var $el=$(this);fullOpts.ignoreIfBlocked&&$el.data("blockUI.isBlocked")||$el.unblock({fadeOut:0})}),this.each(function(){"static"==$.css(this,"position")&&(this.style.position="relative",$(this).data("blockUI.static",!0)),this.style.zoom=1,install(this,opts)})},$.fn.unblock=function(opts){return this[0]===window?($.unblockUI(opts),this):this.each(function(){remove(this,opts)})},$.blockUI.version=2.7,$.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:!0,theme:!1,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:!1,baseZ:1e3,centerX:!0,centerY:!0,allowBodyStretch:!0,bindEvents:!0,constrainTabKey:!0,fadeIn:200,fadeOut:400,timeout:0,showOverlay:!0,focusInput:!0,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:!1};var pageBlock=null,pageBlockEls=[];function install(el,opts){var lyr2,$par,t,l,fixT,fixL,cb1,cb2,to,full=el==window,msg=opts&&void 0!==opts.message?opts.message:void 0;(opts=$.extend({},$.blockUI.defaults,opts||{})).ignoreIfBlocked&&$(el).data("blockUI.isBlocked")||(opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{}),t=$.extend({},$.blockUI.defaults.css,opts.css||{}),opts.onOverlayClick&&(opts.overlayCSS.cursor="pointer"),l=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{}),msg=void 0===msg?opts.message:msg,full&&pageBlock&&remove(window,{fadeOut:0}),msg&&"string"!=typeof msg&&(msg.parentNode||msg.jquery)&&(lyr2=msg.jquery?msg[0]:msg,cb1={},$(el).data("blockUI.history",cb1),cb1.el=lyr2,cb1.parent=lyr2.parentNode,cb1.display=lyr2.style.display,cb1.position=lyr2.style.position,cb1.parent&&cb1.parent.removeChild(lyr2)),$(el).data("blockUI.onUnblock",opts.onUnblock),to=opts.baseZ,cb1=msie||opts.forceIframe?$('<iframe class="blockUI" style="z-index:'+to+++';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>'):$('<div class="blockUI" style="display:none"></div>'),lyr2=opts.theme?$('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+to+++';display:none"></div>'):$('<div class="blockUI blockOverlay" style="z-index:'+to+++';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>'),opts.theme&&full?(cb2='<div class="blockUI '+opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(to+10)+';display:none;position:fixed">',opts.title&&(cb2+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>"),cb2+='<div class="ui-widget-content ui-dialog-content"></div>',cb2+="</div>"):opts.theme?(cb2='<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(to+10)+';display:none;position:absolute">',opts.title&&(cb2+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>"),cb2+='<div class="ui-widget-content ui-dialog-content"></div>',cb2+="</div>"):cb2=full?'<div class="blockUI '+opts.blockMsgClass+' blockPage" style="z-index:'+(to+10)+';display:none;position:fixed"></div>':'<div class="blockUI '+opts.blockMsgClass+' blockElement" style="z-index:'+(to+10)+';display:none;position:absolute"></div>',to=$(cb2),msg&&(opts.theme?(to.css(l),to.addClass("ui-widget-content")):to.css(t)),opts.theme||lyr2.css(opts.overlayCSS),lyr2.css("position",full?"fixed":"absolute"),(msie||opts.forceIframe)&&cb1.css("opacity",0),cb2=[cb1,lyr2,to],$par=$(full?"body":el),$.each(cb2,function(){this.appendTo($par)}),opts.theme&&opts.draggable&&$.fn.draggable&&to.draggable({handle:".ui-dialog-titlebar",cancel:"li"}),l=setExpr&&(!$.support.boxModel||0<$("object,embed",full?null:el).length),(ie6||l)&&(full&&opts.allowBodyStretch&&$.support.boxModel&&$("html,body").css("height","100%"),!ie6&&$.support.boxModel||full||(t=sz(el,"borderTopWidth"),l=sz(el,"borderLeftWidth"),fixT=t?"(0 - "+t+")":0,fixL=l?"(0 - "+l+")":0),$.each(cb2,function(top,s){s=s[0].style;s.position="absolute",top<2?(full?s.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+opts.quirksmodeOffsetHack+') + "px"'):s.setExpression("height",'this.parentNode.offsetHeight + "px"'),full?s.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):s.setExpression("width",'this.parentNode.offsetWidth + "px"'),fixL&&s.setExpression("left",fixL),fixT&&s.setExpression("top",fixT)):opts.centerY?(full&&s.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),s.marginTop=0):!opts.centerY&&full&&(top=opts.css&&opts.css.top?parseInt(opts.css.top,10):0,s.setExpression("top","((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+top+') + "px"'))})),msg&&((opts.theme?to.find(".ui-widget-content"):to).append(msg),(msg.jquery||msg.nodeType)&&$(msg).show()),(msie||opts.forceIframe)&&opts.showOverlay&&cb1.show(),opts.fadeIn?(cb2=opts.onBlock||noOp,cb1=opts.showOverlay&&!msg?cb2:noOp,cb2=msg?cb2:noOp,opts.showOverlay&&lyr2._fadeIn(opts.fadeIn,cb1),msg&&to._fadeIn(opts.fadeIn,cb2)):(opts.showOverlay&&lyr2.show(),msg&&to.show(),opts.onBlock&&opts.onBlock.on(to)()),bind(1,el,opts),full?(pageBlock=to[0],pageBlockEls=$(opts.focusableElements,pageBlock),opts.focusInput&&setTimeout(focus,20)):function(el,x,y){var t=el.parentNode,s=el.style,l=(t.offsetWidth-el.offsetWidth)/2-sz(t,"borderLeftWidth"),t=(t.offsetHeight-el.offsetHeight)/2-sz(t,"borderTopWidth");x&&(s.left=0<l?l+"px":"0");y&&(s.top=0<t?t+"px":"0")}(to[0],opts.centerX,opts.centerY),opts.timeout&&(to=setTimeout(function(){full?$.unblockUI(opts):$(el).unblock(opts)},opts.timeout),$(el).data("blockUI.timeout",to)))}function remove(el,opts){var count,els,full=el==window,$el=$(el),data=$el.data("blockUI.history"),to=$el.data("blockUI.timeout");to&&(clearTimeout(to),$el.removeData("blockUI.timeout")),opts=$.extend({},$.blockUI.defaults,opts||{}),bind(0,el,opts),null===opts.onUnblock&&(opts.onUnblock=$el.data("blockUI.onUnblock"),$el.removeData("blockUI.onUnblock")),els=full?$("body").children().filter(".blockUI").add("body > .blockUI"):$el.find(">.blockUI"),opts.cursorReset&&(1<els.length&&(els[1].style.cursor=opts.cursorReset),2<els.length&&(els[2].style.cursor=opts.cursorReset)),full&&(pageBlock=pageBlockEls=null),opts.fadeOut?(count=els.length,els.stop().fadeOut(opts.fadeOut,function(){0==--count&&reset(els,data,opts,el)})):reset(els,data,opts,el)}function reset(els,data,cssW,w){var body=$(w);body.data("blockUI.isBlocked")||(els.each(function(i,o){this.parentNode&&this.parentNode.removeChild(this)}),data&&data.el&&(data.el.style.display=data.display,data.el.style.position=data.position,data.el.style.cursor="default",data.parent&&data.parent.appendChild(data.el),body.removeData("blockUI.history")),body.data("blockUI.static")&&body.css("position","static"),"function"==typeof cssW.onUnblock&&cssW.onUnblock(w,cssW),w=(body=$(document.body)).width(),cssW=body[0].style.width,body.width(w-1).width(w),body[0].style.width=cssW)}function bind(b,$el,opts){var events=$el==window,$el=$($el);!b&&(events&&!pageBlock||!events&&!$el.data("blockUI.isBlocked"))||($el.data("blockUI.isBlocked",b),events&&opts.bindEvents&&(!b||opts.showOverlay)&&(events="mousedown mouseup keydown keypress keyup touchstart touchend touchmove",b?$(document).on(events,opts,handler):$(document).off(events,handler)))}function handler(e){if("keydown"===e.type&&e.keyCode&&9==e.keyCode&&pageBlock&&e.data.constrainTabKey){var opts=pageBlockEls,target=!e.shiftKey&&e.target===opts[opts.length-1],back=e.shiftKey&&e.target===opts[0];if(target||back)return setTimeout(function(){focus(back)},10),!1}opts=e.data,target=$(e.target);return target.hasClass("blockOverlay")&&opts.onOverlayClick&&opts.onOverlayClick(e),0<target.parents("div."+opts.blockMsgClass).length||0===target.parents().children().filter("div.blockUI").length}function focus(e){!pageBlockEls||(e=pageBlockEls[!0===e?pageBlockEls.length-1:0])&&e.focus()}function sz(el,p){return parseInt($.css(el,p),10)||0}}($jQ)}($jQ)}($jQ),function($){var mouseProto,_mouseInit,_mouseDestroy,touchHandled;function simulateMouseEvent(event,simulatedType){var touch,simulatedEvent;1<event.originalEvent.touches.length||(event.preventDefault(),touch=event.originalEvent.changedTouches[0],(simulatedEvent=document.createEvent("MouseEvents")).initMouseEvent(simulatedType,!0,!0,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,!1,!1,!1,!1,0,null),event.target.dispatchEvent(simulatedEvent))}$.support.touch="ontouchend"in document,$.support.touch&&(mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,_mouseDestroy=mouseProto._mouseDestroy,mouseProto._touchStart=function(event){!touchHandled&&this._mouseCapture(event.originalEvent.changedTouches[0])&&(touchHandled=!0,this._touchMoved=!1,simulateMouseEvent(event,"mouseover"),simulateMouseEvent(event,"mousemove"),simulateMouseEvent(event,"mousedown"))},mouseProto._touchMove=function(event){touchHandled&&(this._touchMoved=!0,simulateMouseEvent(event,"mousemove"))},mouseProto._touchEnd=function(event){touchHandled&&(simulateMouseEvent(event,"mouseup"),simulateMouseEvent(event,"mouseout"),this._touchMoved||simulateMouseEvent(event,"click"),touchHandled=!1)},mouseProto._mouseInit=function(){this.element.on("touchstart",$.proxy(this,"_touchStart")),this.element.on("touchmove",$.proxy(this,"_touchMove")),this.element.on("touchend",$.proxy(this,"_touchEnd")),_mouseInit.call(this)},mouseProto._mouseDestroy=function(){this.element.unbind({touchstart:$.proxy(this,"_touchStart"),touchmove:$.proxy(this,"_touchMove"),touchend:$.proxy(this,"_touchEnd")}),_mouseDestroy.call(this)})}($jQ),websight.sooqr.ResultsPanel=function(controllerInstance,parameters){this._name="ResultsPanel",this.controllerInstance=controllerInstance,this.container=this.controllerInstance.container,this.resultContainer=null,this.parameters=parameters,this.persistentParameters={sortBy:""},this.showMoreButton=null,this.moreResultsLoader=null,this.resultOffset=0,this.lastResultParameters={},this.lastSuccessfulResultParameters={},this.lastScrollPosition=null,this.addResultsOnScroll="addResultsOnScroll"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.addResultsOnScroll,this.setPersistentParameters=function(parameters){var options=["sortBy","viewType"];for(k in options)options[k]in parameters&&(this.persistentParameters[options[k]]=parameters[options[k]])},this.updateResults=function(parameters){if(this.toggleMoreResultsLoader(!1),this.lastResultParameters=parameters,this.resultContainer=null,parameters.numberOfResults&&(this.lastSuccessfulResultParameters=parameters),null!=parameters.resultsPanel.resultOffset&&0<parameters.resultsPanel.resultOffset){var autoScrollEnabled=$jQ('<div class="sooqrSearchResults">'+parameters.resultsPanel.html+"</div>"),disableAutoScrollToTopIsZero=$jQ("div.results, .sqr-results",autoScrollEnabled[0]);this.addClickEvents(disableAutoScrollToTopIsZero.children(),parameters.resultsPanel),this.resultContainer=$jQ("div.sooqrSearchResultsContainer div.sooqrSearchResults",this.container),this.resultContainer.find("div.results, .sqr-results").append(disableAutoScrollToTopIsZero.children())}else{this.resultOffset=0,this.resultContainer=$jQ("div.sooqrSearchResultsContainer div.sooqrSearchResults",this.container),controllerInstance.needResultsRender(parameters)&&this.resultContainer.html(parameters.resultsPanel.html),$jQ("div.options div.views ul li, div.sqr-options div.sqr-views ul li",this.resultContainer).on("click",$jQ.proxy(this.handleViewClick,this)),"disableCustomSort"in this.controllerInstance.indexSettings.view&&0!=this.controllerInstance.indexSettings.view.disableCustomSort||$jQ('div.sort select[name="sortby"], div.sqr-sort select[name="sortby"]',this.container).selectbox({effect:"fade",onOpen:function(activeOption){$jQ("#"+activeOption.settings.classHolder+"_"+activeOption.uid).toggleClass(activeOption.settings.classHolder+"Open",activeOption.isOpen);activeOption=$jQ("#"+activeOption.settings.classOptions+"_"+activeOption.uid).find('a[rel="'+activeOption.input.val()+'"]').parent();activeOption.siblings().removeClass("sbActive"),activeOption.addClass("sbActive")},onClose:function(inst){$jQ("#"+inst.settings.classHolder+"_"+inst.uid).toggleClass(inst.settings.classHolder+"Open",inst.isOpen)},onChange:$jQ.proxy(function(val,inst){console.log("Changing?"),$jQ.proxy(this.handleSortChange(val),this)},this)}),$jQ('ul[class="sortby"] a, ul[class="sqr-sortby"] a',this.container).on("click",$jQ.proxy(this.handleSortClick,this));const controllerInstanceContainer=$jQ(this.controllerInstance.container);var canScroll=document.body.contains(controllerInstanceContainer[0]),autoScrollEnabled=controllerInstanceContainer.is(":visible");canScroll&&autoScrollEnabled&&(disableAutoScrollToTopIsZero=controllerInstanceContainer.position().top<$jQ(document).scrollTop(),canScroll=autoScrollEnabled&&disableAutoScrollToTopIsZero,autoScrollEnabled=!("disable_auto_scroll_to_top"in this.controllerInstance.indexSettings.view),disableAutoScrollToTopIsZero=0===this.controllerInstance.indexSettings.view.disable_auto_scroll_to_top,(autoScrollEnabled||disableAutoScrollToTopIsZero)&&canScroll&&$jQ("html, body").animate({scrollTop:$jQ(this.controllerInstance.container).position().top},"fast")),0<parameters.numberOfResults&&(this.addClickEvents($jQ("div .results div.resultItem",this.resultsContainer),parameters.resultsPanel),this.addClickEvents($jQ("div .sqr-results .sqr-resultItem",this.resultsContainer),parameters.resultsPanel))}"headerHtml"in parameters.resultsPanel?this.container.find("div.sooqrSearchHeader").html(parameters.resultsPanel.headerHtml).show():this.container.find("div.sooqrSearchHeader").hide(),"footerHtml"in parameters.resultsPanel?this.container.find("div.sooqrSearchFooter").html(parameters.resultsPanel.footerHtml).show():this.container.find("div.sooqrSearchFooter").hide(),$jQ(".closeButton, .sqr-closeButton, .sqr-mobile-bottom-close-button",this.container).on("click",$jQ.proxy(function(event){this.controllerInstance.hideContainer()},this)),$jQ(".sqr-mobile-bottom-up-button",this.container).on("click",function(){$jQ("html, body").animate({scrollTop:0},1e3)}),this.toggleShowMoreButton(parameters.resultsPanel.resultsInResponse+parameters.resultsPanel.resultOffset<parameters.numberOfResults,parameters.numberOfResults,parameters.numberOfResults),0<parameters.numberOfResults&&this.updateResultsCounter(parameters.numberOfResults),this.updateResultNotifier(),this.addResultsOnScroll&&$jQ(window).off("scroll",this.moreResultsScrollHandler).on("scroll",this.moreResultsScrollHandler),4<=this.controllerInstance.indexSettings.view.cssVersion&&($jQ(window).off("scroll",this.optionBarScrollHandler).on("scroll",this.optionBarScrollHandler),this.handleOptionBarWindowScroll()),"mobileBottomButton"in this.controllerInstance.indexSettings.view&&1!=this.controllerInstance.indexSettings.view.mobileBottomButton||($jQ(window).off("scroll",this.mobileBottomButtonsScrollHandler).on("scroll",this.mobileBottomButtonsScrollHandler),this.handleMobileBottomButtonsWindowScroll())},this.handleViewClick=function(currentView){var viewObject=$jQ(currentView.target),currentView=$jQ("li.active, li.sqr-active",viewObject.closest("ul"));currentView.length&&($jQ("div.results, .sqr-results",this.resultContainer).removeClass(currentView.attr("rel")+" sqr-"+currentView.attr("rel")),currentView.removeClass("active").removeClass("sqr-active")),viewObject.addClass("active sqr-active"),$jQ("div.results, .sqr-results",this.resultContainer).addClass(viewObject.attr("rel")+" sqr-"+viewObject.attr("rel")),this.persistentParameters.viewType=viewObject.attr("rel"),$jQ(this.controllerInstance).trigger("viewTypeChanged",[viewObject.attr("rel")])},this.handleMoreResultsWindowScroll=function(event){if($jQ(this.resultContainer).is(":hidden")||null==this.showMoreButton)return!1;var scrollTop,bottomOfPanel;$jQ(this.resultContainer).find("div.sqr-out-of-view").hide(),this.lastResultParameters.resultsPanel.resultsInResponse+Math.max(0,this.lastResultParameters.resultsPanel.resultOffset)<this.lastResultParameters.resultsPanel.numberOfResults&&(scrollTop=websight.util.getWindowScrollTop(),bottomOfPanel=Math.floor(this.resultContainer.height()+this.container.offset().top),scrollTop+$jQ(window).height()>=.8*bottomOfPanel&&this.lastScrollPosition!=scrollTop+$jQ(window).height()&&(this.lastScrollPosition=scrollTop+$jQ(window).height(),$jQ(window).off("scroll",this.moreResultsScrollHandler),this.loadMoreResults()))},this.moreResultsScrollHandler="function"==typeof websight.util.debounce?websight.util.debounce($jQ.proxy(this.handleMoreResultsWindowScroll,this),100):$jQ.proxy(this.handleMoreResultsWindowScroll,this),this.handleOptionBarWindowScroll=function(event){var sqrOptions=$jQ("div.sqr-options",this.resultContainer),scrollTop=websight.util.getWindowScrollTop(),isFixed=sqrOptions.hasClass("sqr-fixed"),sqrOptionsTop=sqrOptions.offset()?sqrOptions.offset().top:0,sqrOptionsOrigTop=sqrOptions.data("sqr-original-top");sqrOptionsTop+100<scrollTop&&!isFixed?(sqrOptions.data("sqr-original-top",sqrOptionsTop),sqrOptions.css({width:sqrOptions.outerWidth()+"px","z-index":this.controllerInstance.parameters.zIndex+1,"margin-left":-$jQ(window).scrollLeft()+"px"}).addClass("sqr-fixed")):scrollTop<=sqrOptionsOrigTop&&isFixed&&sqrOptions.css("width","").removeClass("sqr-fixed")},this.optionBarScrollHandler="function"==typeof websight.util.debounce?websight.util.debounce($jQ.proxy(this.handleOptionBarWindowScroll,this),100):$jQ.proxy(this.handleOptionBarWindowScroll,this),this.addClickEvents=function(objectsToTrack,parameters){if(null!=this.controllerInstance.addClickEvents)return $jQ.proxy(this.controllerInstance.addClickEvents,this.controllerInstance)(objectsToTrack,parameters);$jQ.each(objectsToTrack,$jQ.proxy(function(index,value){var url;1==this.controllerInstance.indexSettings.view.enableResultitemClick&&(url=$jQ("a",value).not(".custom-link").attr("href"),$jQ(value).on("click",$jQ.proxy(function(event){var resultTitle=$jQ(event.currentTarget).closest(".resultItem, .sqr-resultItem"),resultId=resultTitle.data("id"),resultTitle=$jQ('a[rel="title"]',resultTitle).attr("title");return"enableBackButton"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.enableBackButton&&this.controllerInstance.searchCallback.saveBackButtonParameters(),(event.ctrlKey||event.metaKey)&&window.open(this.controllerInstance.searchCallback.createAnalyticsUrl(url),"_blank").focus(),this.onProductClick(url,parameters.resultOffset+index+1,resultId,resultTitle,event),event.preventDefault(),event.stopPropagation(),!1},this))),$jQ("a",value).not(".custom-link").on("click",$jQ.proxy(function(event){var url=$jQ(event.currentTarget).attr("href"),resultId=$jQ(event.currentTarget).closest(".resultItem, .sqr-resultItem"),resultTitle=$jQ('a[rel="title"]',resultId),resultId=resultId.data("id"),resultTitle=resultTitle.attr("title")?resultTitle.attr("title"):resultTitle.text();"enableBackButton"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.enableBackButton&&this.controllerInstance.searchCallback.saveBackButtonParameters(),(event.ctrlKey||event.metaKey)&&window.open(this.controllerInstance.searchCallback.createAnalyticsUrl(url),"_blank").focus(),this.onProductClick(event.currentTarget.href,parameters.resultOffset+index+1,resultId,resultTitle,event),event.preventDefault(),event.stopPropagation()},this))},this))},this.changeSort=function(sortBy){this.persistentParameters.sortBy=sortBy,this.controllerInstance.searchCallback.directCallback({sortBy:this.persistentParameters.sortBy,filterInitiated:!0})},this.handleSortChange=function(val){this.changeSort(val)},this.handleSortClick=function(event){return this.changeSort($jQ(event.target).attr("rel")),event.preventDefault(),!1},this.updateResultsCounter=function(numberOfResults){$jQ("div.numberOfResults",this.container).html(numberOfResults+" resultaten")},this.toggleShowMoreButton=function(state){this.showMoreButton=$jQ("a.moreResults, a.sqr-moreResults",this.container),0<this.showMoreButton.length&&(this.showMoreButton.off("click",$jQ.proxy(this.loadMoreResults,this)),this.showMoreButton.on("click",$jQ.proxy(this.loadMoreResults,this)),this.showMoreButton.css("display",state?"block":"none"))},this.toggleMoreResultsLoader=function(state){this.moreResultsLoader=$jQ("div.moreResultsLoader",this.container),0<this.moreResultsLoader.length&&this.moreResultsLoader.css("display",state?"block":"none")},this.onProductClick=function(url,resultIndex,resultId,resultTitle,event){resultId||console.warn("Product id is not set!");var clickData={query:this.controllerInstance.searchCallback.getQueryParameters().searchQuery,full_query:this.controllerInstance.searchCallback.getQueryParameters(),clicked_result_idx:resultIndex,clicked_result_title:resultTitle,clicked_result_url:url,clicked_solr_id:resultId};this.controllerInstance.triggerEvent("click",clickData),$jQ(this.controllerInstance).trigger("click",[url,resultIndex,resultId,resultTitle])},this.loadMoreResults=function(){return this.resultOffset+=this.lastResultParameters.resultsPanel.resultsInResponse,this.toggleShowMoreButton(!1),this.toggleMoreResultsLoader(!0),this.controllerInstance.searchCallback.directCallback({offset:this.resultOffset,filterInitiated:!0}),!1},this.updateResultNotifier=function(){var controllerInstance,container=$jQ(this.resultContainer),outOfViewContainerTop=container.offset(),outOfViewContainer=outOfViewContainerTop.top+container.height();0<outOfViewContainer&&0<websight.util.getWindowScrollTop()&&outOfViewContainer<websight.util.getWindowScrollTop()?(container.css("position","relative"),outOfViewContainer=this.lastResultParameters.resultsPanel.outOfViewText,0==$jQ("div.sqr-out-of-view",container).length?(controllerInstance=this.controllerInstance,container.append('<div class="sqr-out-of-view sooqrOutOfView"><span>'+outOfViewContainer+"</span></div>"),$jQ("div.sqr-out-of-view",container).on("click",function(event){return $jQ("html, body").animate({scrollTop:0},"fast"),$jQ(this).closest("div.sqr-out-of-view").hide(),controllerInstance.updateMinimumHeight(),event.preventDefault(),!1})):$jQ("div.sqr-out-of-view span",container).html(outOfViewContainer),outOfViewContainer=$jQ("div.sqr-out-of-view",container),outOfViewContainerTop=websight.util.getWindowScrollTop()-outOfViewContainerTop.top+(Math.floor($jQ(window).height()/2)-Math.floor(outOfViewContainer.height()/2)),outOfViewContainer.css({"position":"absolute","left":Math.round(container.width()/2)-Math.floor(outOfViewContainer.width()/2)+"px","top":Math.floor(outOfViewContainerTop)+"px"})):($jQ("div.sqr-out-of-view",container).hide(),container.css("position","none"))},this.getContainerHeight=function(){return this.resultContainer?this.resultContainer.find(".sqr-results").height():0},this.toggleMoreResultsLoaderCallback=function(state){this.addResultsOnScroll&&(state?$jQ(window).off("scroll",this.moreResultsScrollHandler).on("scroll",this.moreResultsScrollHandler):$jQ(window).off("scroll",this.moreResultsScrollHandler))},this.translateWordsSetByJavascript=function(parameters){null!=parameters.translations&&($jQ("[data-results-text]",this.container).html(null!=parameters.translations.results?parameters.translations.results:"Resultaten"),$jQ("[data-filters-text]",this.container).html(null!=parameters.translations.filters?parameters.translations.filters:"Filteren"))},this.handleMobileBottomButtonsWindowScroll=function(event){var sqrMobileBottomButtons=$jQ(".sqr-mobile-bottom-button");if(!sqrMobileBottomButtons.length)return!1;var scrollTop=websight.util.getWindowScrollTop(),sqrMobileBottomButtonsTop=this.resultContainer.offset().top,sqrIsMobileBottomButtonsVisible=sqrMobileBottomButtons.is(":visible");sqrMobileBottomButtonsTop<scrollTop&&!sqrIsMobileBottomButtonsVisible?sqrMobileBottomButtons.fadeIn():scrollTop<=sqrMobileBottomButtonsTop&&sqrIsMobileBottomButtonsVisible&&sqrMobileBottomButtons.fadeOut()},this.mobileBottomButtonsScrollHandler="function"==typeof websight.util.debounce?websight.util.debounce($jQ.proxy(this.handleMobileBottomButtonsWindowScroll,this),100):$jQ.proxy(this.handleMobileBottomButtonsWindowScroll,this)},websight.sooqr.SearchCallback=function(controllerInstance){this.delay=300,this.requestIndex=-1,this.requestId=null,this.scrollAfterRequest=null,this.timeoutHandle=null,this.inputField=null,this.controllerInstance=controllerInstance,this.filterPanel=null,this.resultsPanel=null,this.previousQueryParameters=null,this.queryParametersHistory=[],this.parameters=this.controllerInstance.getParameters(),this.delayedCallback=function(additionalParameters,inputField){this.clearTimeout(),null==additionalParameters&&(additionalParameters={}),this.controllerInstance.indexSettings.view.keypressDelay&&(this.delay=this.controllerInstance.indexSettings.view.keypressDelay),this.timeoutHandle=setTimeout($jQ.proxy(function(){this.callback(additionalParameters,inputField)},this),this.delay)},this.directCallback=function(additionalParameters){this.clearTimeout(),null==additionalParameters&&(additionalParameters={}),this.timeoutHandle=setTimeout($jQ.proxy(function(){this.callback(additionalParameters)},this),0)},this.clearTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},this.callback=function(queryParameters,filterQuery){this.clearTimeout(),this.queryParameters=queryParameters,void 0===filterQuery&&"queryField"in this.controllerInstance?this.inputField=this.controllerInstance.queryField:this.inputField=filterQuery;var searchQuery=this.controllerInstance.getSearchQuery(this.inputField);if((null==searchQuery||0==searchQuery.length)&&"Filter"!=this.controllerInstance.objectName){if(!("allowEmptyQuery"in this.controllerInstance.indexSettings.view&&0!=this.controllerInstance.indexSettings.view.allowEmptyQuery))return void this.controllerInstance.hideContainer();searchQuery=""}this.enableLoaderIcon();filterQuery=null;if(this.filterPanel&&(null!=queryParameters.filterInitiated&&1==queryParameters.filterInitiated?filterQuery=this.filterPanel.toArray():queryParameters.filtersShowAll||this.filterPanel.clearLastFilterQuery()),queryParameters.filterInitiated||(filterQuery=this.controllerInstance.appendDefaultFilters(filterQuery)),filterQuery=this.controllerInstance.appendFixedFilters(filterQuery),queryParameters.exclusionQuery=this.controllerInstance.getExclusionFilters(),this.filterPanel)for(var k in filterParameters=this.filterPanel.persistentParameters,filterParameters)queryParameters[k]=filterParameters[k];if(filterQuery=this.controllerInstance.appendSecuredFilters(filterQuery),queryParameters=this.controllerInstance.appendSecuredFiltersParameters(queryParameters),queryParameters=this.controllerInstance.appendDynamicFieldsParameters(queryParameters),this.resultsPanel)for(var k in this.resultsPanel.persistentParameters)queryParameters[k]=this.resultsPanel.persistentParameters[k];this.sendSearchQuery(searchQuery,filterQuery,queryParameters)},this.sendSearchQuery=function(searchQuery,filterQuery,queryParameters){return null==queryParameters.sortBy&&(queryParameters.sortBy=0),null==queryParameters.offset&&(queryParameters.offset=0),null==queryParameters.filterInitiated&&(queryParameters.filterInitiated=!1),null==queryParameters.triggerFilter&&(queryParameters.triggerFilter=null),null==queryParameters.filtersShowAll&&(queryParameters.filtersShowAll=!1),null==queryParameters.enableFiltersShowAll&&(queryParameters.enableFiltersShowAll=!1),null==queryParameters.filterValuesShowAll&&(queryParameters.filterValuesShowAll=null),null==queryParameters.securedFiltersHash&&(queryParameters.securedFiltersHash=!1),null==queryParameters.locale&&(queryParameters.locale=this.parameters.locale||websight.util.getLanguage()),null!=this.previousQueryParameters&&null!==this.previousQueryParameters.searchQuery&&void 0!==this.previousQueryParameters.searchQuery?null==searchQuery||searchQuery.match(new RegExp("^"+websight.util.regexpEscape(this.previousQueryParameters.searchQuery),"i"))||(this.requestId=websight.util.randomNumber(),this.requestIndex=-1):this.requestId=websight.util.randomNumber(),this.requestIndex++,this.previousQueryParameters=queryParameters,this.previousQueryParameters.searchQuery=searchQuery,this.previousQueryParameters.filterQuery=filterQuery,this.queryParametersHistory.push(this.previousQueryParameters),this.queryParametersHistory=this.queryParametersHistory.slice(-10),$jQ(this.controllerInstance).trigger("sendSearchQuery",[searchQuery,filterQuery,queryParameters]),"enableHash"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.enableHash&&this.serializeSearchToHash(),null!=this.controllerInstance.indexSettings.connection.proxy?this.sendSearchQueryByProxy(searchQuery,filterQuery,queryParameters):this.sendSearchQueryByScript(searchQuery,filterQuery,queryParameters)},this.saveBackButtonParameters=function(){var data=this.getQueryParameters(),data={"u":window.location.href,"q":data,"p":this.controllerInstance.getParameters()};data.p.scrollAfterRequest=websight.util.getWindowScrollTop(),sessionStorage.setItem("__sqrlq",JSON.stringify(data))},this.sendSearchQueryByProxy=function(searchQuery,filterQuery,queryParameters){return $jQ.ajax(this.controllerInstance.indexSettings.connection.proxy,{async:!0,complete:this.sendSearchQueryByProxyCompleted,context:this,dataType:"json",data:this.buildSearchQuery(searchQuery,filterQuery,queryParameters),type:"POST"})},this.sendSearchQueryByScript=function(searchQuery,filterQuery,queryData){var dynamicScriptUrl=document.location.protocol+"//"+this.controllerInstance.indexSettings.connection.server+"/"+this.controllerInstance.getApiMethod()+"/script/?",queryData=this.buildSearchQuery(searchQuery,filterQuery,queryData);return $jQ.getScript(dynamicScriptUrl+$jQ.param(queryData))},this.buildSearchQuery=function(data,sessionId,queryParameters){for(var exclusionQuery={},keys=Object.keys(queryParameters.exclusionQuery),i=0,l=keys.length;i<l;i++){var key=keys[i],values=queryParameters.exclusionQuery[key];Array.isArray(values)&&(values=values.join(",")),exclusionQuery[key]=values}data={"type":this.controllerInstance.objectName.toLowerCase(),"searchQuery":data,"filterQuery":sessionId,"xq":exclusionQuery,"filterInitiated":queryParameters.filterInitiated,"triggerFilter":queryParameters.triggerFilter,"triggerFilterValue":queryParameters.triggerFilterValue,"triggerFilterIndex":queryParameters.triggerFilterIndex,"filtersShowAll":queryParameters.filtersShowAll,"enableFiltersShowAll":queryParameters.enableFiltersShowAll,"filterValuesShowAll":queryParameters.filterValuesShowAll,"securedFiltersHash":queryParameters.securedFiltersHash,"sortBy":queryParameters.sortBy,"offset":queryParameters.offset,"limit":queryParameters.limit||this.controllerInstance.indexSettings.view.resultsPerPage,"requestIndex":this.requestIndex,"locale":queryParameters.locale,"url":window.location.pathname},sessionId=this.controllerInstance.parameters;sessionId.personalization&&"shopping-minds"===sessionId.personalization.type&&(data.sm_uid=sessionId.personalization.value),sessionId.personalization&&"squeezely"===sessionId.personalization.type&&(data.sz_uid=sessionId.personalization.value);sessionId=this.getCookie("sqzllocal");sessionId&&(data.sz_uid=sessionId);sessionId=sessionStorage.getItem("sessionId");return sessionId&&(data.sid=sessionId,data.snowplow=function(match){match=match||"_sp_";var split=new RegExp(match+"id\\.[a-f0-9]+=([^;]+);?"),match=document.cookie.match(split);if(match){split=match[1].split(".");if(match&&match[1])return{"domain_userid":split[0],"domain_sessionidx":split[2],"domain_sessionid":split[5]}}}()),"viewType"in queryParameters&&(data.viewType=queryParameters.viewType),"dynamicFields"in queryParameters&&(data.dynamicFields=queryParameters.dynamicFields),this.parameters.index&&(data.index=this.parameters.index),this.parameters.view&&(data.view=this.parameters.view),this.parameters.account&&(data.account=this.parameters.account),data},this.getCookie=function(parts){parts=`; ${document.cookie}`.split(`; ${parts}=`);if(2===parts.length)return parts.pop().split(";").shift()},this.sendSearchQueryByScriptCompleted=function(result){this.disableLoaderIcon(),this.processSearchQueryResult(result,result)},this.sendSearchQueryByProxyCompleted=function(httpObject,status){if(this.disableLoaderIcon(),0!=httpObject.responseText.length){try{var fullResult=$jQ.parseJSON(httpObject.responseText);result=fullResult.sooqr}catch(e){return websight.sooqr.Debug.log(e),!1}this.processSearchQueryResult(result,fullResult)}else this.controllerInstance.hideContainer()},this.compareFilters=function(filters1,filters2){for(var id in filters1){var values=filters1[id];for(i in values)if(void 0!==filters2[id]&&-1===filters2[id].indexOf(values[i]))return!1}return!0},this.processSearchQueryResult=function(result,fullResult){var query=result.searchQuery,filters=[];for(i in result.filtersPanel.filters){var filter=result.filtersPanel.filters[i];for(fI in filter.values){var value=filter.values[fI];!0===value.a&&(void 0===filters[filter.id]&&(filters[filter.id]=[]),filters[filter.id].push(value.l))}}for(var instance,pQueryParameters,i=this.queryParametersHistory.length-1;0<=i;i--){var queryParameters=this.queryParametersHistory[i];if(this.compareFilters(filters,queryParameters.filterQuery)&&query==queryParameters.searchQuery){this.queryParametersHistory[i].numberOfResults=result.numberOfResults;break}}if(result.resultsPanel&&result.resultsPanel.enabled&&null==this.resultsPanel&&websight.sooqr.ResultsPanel&&(this.resultsPanel=new websight.sooqr.ResultsPanel(this.controllerInstance),this.resultsPanel.setPersistentParameters(this.previousQueryParameters),pQueryParameters=(instance=this).previousQueryParameters,this.resultsPanel.container.on("click",".sqr-banners a",function(bannerData){bannerData.preventDefault();var url=this.getAttribute("href"),target=this.getAttribute("target"),bannerData=(this.dataset.id,{locale:pQueryParameters.locale,query:pQueryParameters.searchQuery,full_query:pQueryParameters,clicked_result_url:url});instance.controllerInstance.triggerEvent("banner",bannerData),target?window.open(url,target):window.location.href=url})),!("requestIndex"in result&&parseInt(result.requestIndex)<this.requestIndex)){if("error"==result.status&&result.statusMessage)return websight.util.log(result.statusMessage),!1;var $filtersContainer,previousQueryParameters,$optionsMobile=!1;if(result.custom&&"string"==typeof result.custom.html&&($optionsMobile=!result.custom.html.trim()),result.faultyResponse=$optionsMobile,this.controllerInstance.tracking&&($filtersContainer={query:this.previousQueryParameters.searchQuery,full_query:this.previousQueryParameters},0==this.previousQueryParameters.filterInitiated?(this.controllerInstance.triggerEvent("query",$filtersContainer),$jQ(this.controllerInstance).trigger("query",[$filtersContainer.query,result.numberOfResults,this.requestId,this.requestIndex,result])):this.controllerInstance.triggerEvent("filter",$filtersContainer)),result.custom&&result.custom.enabled){$jQ(this.controllerInstance.container).children("div").not(".sooqrSearchOptionsMobile").hide(),this.controllerInstance.container.addClass("sqr-custom"),this.controllerInstance.container.append('<div class="sooqrCustom">'+result.custom.html+"</div>"),$jQ(".sooqrSearchMobileTabs",this.controllerInstance.container).css("visibility","hidden");var queryParametersHistoryHasResults=!1;for(i in this.queryParametersHistory)if(0<this.queryParametersHistory[i].numberOfResults){queryParametersHistoryHasResults=!0;break}return $jQ(".sqr-has-previous-query",this.controllerInstance.container).toggle(queryParametersHistoryHasResults),$jQ('a[rel="load-last-query"]',this.controllerInstance.container).toggle(queryParametersHistoryHasResults).on("click",$jQ.proxy(function(event){event.preventDefault(),this.reloadLastQuery()},this)),$jQ(".closeButton, .sqr-closeButton",this.controllerInstance.container).on("click",$jQ.proxy(function(event){this.controllerInstance.hideContainer()},this)),this.controllerInstance.showContainer(),void(0===result.numberOfResults&&$jQ(this.controllerInstance).trigger("noResults",[fullResult]))}if($jQ("div.sooqrCustom").length&&($jQ(".sooqrSearchMobileTabs",this.controllerInstance.container).css("visibility","visible"),$jQ("div.sooqrCustom",this.controllerInstance.container).remove(),this.controllerInstance.container.removeClass("sqr-custom").children("div").not(".sooqrSearchOptionsMobile").show(),$optionsMobile=$jQ(".sooqrSearchOptionsMobile",this.container),$filtersContainer=$jQ(".sooqrSearchFilters",this.container),$jQ(window).width()<this.controllerInstance.indexSettings.view.responsiveMobileWidth&&this.activeResponsiveWidth!=this.controllerInstance.indexSettings.view.responsiveMobileWidth&&$jQ(".sooqrSearchMobileTabsResults",$optionsMobile).hasClass("sooqrSearchMobileTabsActive")&&$filtersContainer.hide()),0==result.numberOfResults)return result.filtersPanel&&result.filtersPanel.enabled&&this.filterPanel&&(result.filterInitiated?this.filterPanel.updateFilters(result.filtersPanel,this.previousQueryParameters):this.filterPanel.togglePanel(!1)),result.resultsPanel&&result.resultsPanel.enabled&&this.resultsPanel&&(this.resultsPanel.updateResults(result),this.controllerInstance.showContainer()),$jQ(this.controllerInstance).trigger("queryResultProcessed",[fullResult]),void $jQ(this.controllerInstance).trigger("noResults",[fullResult]);result.resultsPanel.enabled&&this.resultsPanel&&!result.filtersPanel.enableFiltersShowAll&&(this.resultsPanel.updateResults(result),this.controllerInstance.showContainer(),$jQ(this.controllerInstance).trigger("updateResults",[fullResult])),result.filtersPanel.enabled&&(null==this.filterPanel?this.filterPanel=new websight.sooqr.FilterPanel(this.controllerInstance,result.filtersPanel,this.previousQueryParameters.filterQuery):(this.filterPanel.togglePanel(!0),result.filterInitiated?result.filtersPanel.enableFiltersShowAll?this.filterPanel.showHiddenFilters(result.filtersPanel):(previousQueryParameters=this.previousQueryParameters,$jQ.proxy(function(){this.updateFilters(result.filtersPanel,previousQueryParameters)},this.filterPanel)()):$jQ.proxy(function(){this.initializePanel(result.filtersPanel)},this.filterPanel)()),$jQ(this.controllerInstance).trigger("updateFilters",[fullResult])),4<=this.controllerInstance.indexSettings.view.cssVersion&&(this.controllerInstance.handleResponsiveResize(),this.resultsPanel.translateWordsSetByJavascript(result)),$jQ(".sqrSearchResultCounter",this.controllerInstance.container).text(result.numberOfResults),$jQ(".sqrSearchResultRemainingCounter",this.controllerInstance.container).text(result.resultsRemaining),null!=this.scrollAfterRequest&&($jQ(window).trigger("scroll"),websight.util.setWindowScrollTop(this.scrollAfterRequest),(this.scrollAfterRequest=null)!=this.resultsPanel&&$jQ("div.sqr-out-of-view",this.resultsPanel.container).hide()),$jQ(this.controllerInstance).trigger("queryResultProcessed",[fullResult])}},this.reloadLastQuery=function(){this.queryParametersHistory.pop();for(var queryParameters=this.queryParametersHistory.pop();0<this.queryParametersHistory.length&&(null==queryParameters.numberOfResults||0==queryParameters.numberOfResults);)queryParameters=this.queryParametersHistory.pop();if(0==this.queryParametersHistory.length)return!1;queryParameters.filterInitiated=!0,"triggerFilter"in this.previousQueryParameters&&"location"===this.filterPanel.getFilterType(this.previousQueryParameters.triggerFilter)&&this.filterPanel.clearGeoFilter(this.previousQueryParameters.triggerFilter),this.controllerInstance.setSearchQuery(queryParameters.searchQuery),this.sendSearchQuery(queryParameters.searchQuery,queryParameters.filterQuery,queryParameters)},this.enableLoaderIcon=function(){$jQ(this.controllerInstance).trigger("loading"),null==this.inputField||this.inputField.hasClass("sooqrQueryBoxLoading")||(this.inputField.addClass("_search_loading"),this.inputField.addClass("sooqrQueryBoxLoading"))},this.disableLoaderIcon=function(){null!=this.inputField&&this.inputField.hasClass("sooqrQueryBoxLoading")&&(this.inputField.removeClass("_search_loading"),this.inputField.removeClass("sooqrQueryBoxLoading")),$jQ(this.controllerInstance).trigger("completedLoading")},this.createAnalyticsUrl=function(url){var qparts={},needsReplace=!1;return this.controllerInstance.indexSettings.googleSearchTracking.enabled&&this.controllerInstance.indexSettings.googleSearchTracking.query_parameter&&(qparts[this.controllerInstance.indexSettings.googleSearchTracking.query_parameter]=encodeURIComponent(this.controllerInstance.getQueryText()),needsReplace=!0),this.controllerInstance.indexSettings.googleAdTracking.enabled&&(qparts.utm_source=encodeURIComponent(this.controllerInstance.indexSettings.googleAdTracking.utm_source),qparts.utm_campaign=encodeURIComponent(this.controllerInstance.indexSettings.googleAdTracking.utm_campaign),qparts.utm_medium=encodeURIComponent(this.controllerInstance.indexSettings.googleAdTracking.utm_medium),this.controllerInstance.indexSettings.googleAdTracking.utm_term&&(qparts.utm_term=encodeURIComponent(this.controllerInstance.getQueryText())),needsReplace=!0),needsReplace?websight.util.replaceQueryVars(url,qparts):url},this.getQueryParameters=function(){var queryParameters=this.previousQueryParameters;if(this.filterPanel)for(k in this.filterPanel.persistentParameters)queryParameters[k]=this.filterPanel.persistentParameters[k];if(this.resultsPanel)for(k in this.resultsPanel.persistentParameters)queryParameters[k]=this.resultsPanel.persistentParameters[k];return queryParameters},this.serializeSearchToHash=function(queryParameters){void 0===queryParameters&&(queryParameters=this.getQueryParameters());var hashValue="#",hash=decodeURIComponent(window.location.hash);hash&&1<(hashValue=null!==hash.match(/sqr:\(/)?hash.replace(/[\&]?sqr:\(.+\)/,""):hash).length&&(hashValue+="&");var queryInHash="";if("searchQuery"in queryParameters&&queryParameters.searchQuery&&queryParameters.searchQuery.length&&(queryInHash+="q["+encodeURIComponent(queryParameters.searchQuery)+"]"),"filterQuery"in queryParameters){var filterId,fixedFilters=this.controllerInstance.getFixedFilters();for(filterId in queryParameters.filterQuery)if(!fixedFilters.hasOwnProperty(filterId)){var values=[],type="f";if(void 0!==queryParameters.filterQuery[filterId].left&&void 0!==queryParameters.filterQuery[filterId].right){var value=queryParameters.filterQuery[filterId];queryInHash+=",slf"+filterId+"["+value.left+","+value.right+","+value.min+","+value.max+"]"}else{if(Array.isArray(queryParameters.filterQuery[filterId]))for(var p in queryParameters.filterQuery[filterId])queryParameters.filterQuery[filterId].hasOwnProperty(p)&&values.push(encodeURIComponent(queryParameters.filterQuery[filterId][p]));else type="sf",values.push(encodeURIComponent(queryParameters.filterQuery[filterId]));queryInHash+=","+type+filterId+"["+values.join(",")+"]"}}}if((queryInHash=queryInHash.replace(/^,/,"")).length&&(hashValue+="sqr:("+queryInHash+")"),(hashValue=hashValue.replace(/&$/,"")).length)if(window.history.replaceState)try{"#"===hashValue?window.history.replaceState("",document.title,window.location.pathname+window.location.search):window.history.replaceState(void 0,void 0,hashValue)}catch(e){window.location.replace((""+window.location).split("#")[0]+hashValue)}else window.location.replace((""+window.location).split("#")[0]+hashValue)},this.parseSearchFromHash=function(){var lastQuery={},hasMatches=!1,match=!1,value="",filterId=null,re=/\[(.+?)\]/g,matchPart=!1,hashQuery=!1,partMatch=null;if(null!==(match=decodeURIComponent(window.location.hash).match(/sqr:\((.+)\)/))){for(;matchPart=re.exec(match[1]);)match[1]=match[1].replace(matchPart[0],matchPart[0].replace(/,/g,";"));for(var hashQuery=match[1].split(/,/),lastQuery={q:{filterInitiated:!1},filterQuery:this.controllerInstance.getFixedFilters()},iIndex=0;iIndex<hashQuery.length;iIndex++)if(null!==(partMatch=hashQuery[iIndex].match(/^([a-z0-9]+)\[(.+)\]$/)))if(hasMatches=!0,"q"===partMatch[1])lastQuery.q.searchQuery=decodeURIComponent(partMatch[2]);else{var filterId=null,type="multi";if(-1!==partMatch[1].indexOf("sf")?(filterId=partMatch[1].replace(/^sf/,""),type="select"):-1!==partMatch[1].indexOf("slf")?(filterId=partMatch[1].replace(/^slf/,""),type="slider"):filterId=partMatch[1].replace(/^f/,""),"multi"===type){for(var p in lastQuery.filterQuery[filterId]=partMatch[2].split(/;/),lastQuery.filterQuery[filterId])if(0<=p){value="";try{value=decodeURIComponent(lastQuery.filterQuery[filterId][p])}catch(err){value=lastQuery.filterQuery[filterId][p]}lastQuery.filterQuery[filterId][p]=value}}else if("slider"===type){void 0===lastQuery.filterQuery[filterId]&&(lastQuery.filterQuery[filterId]={});var options=partMatch[2].split(/;/);for(p in options){try{value=decodeURIComponent(options[p])}catch(err){value=options[p]}switch(parseInt(p)){case 0:lastQuery.filterQuery[filterId].left=value;break;case 1:lastQuery.filterQuery[filterId].right=value;break;case 2:lastQuery.filterQuery[filterId].min=value;break;case 3:lastQuery.filterQuery[filterId].max=value}}}else{value="";try{value=decodeURIComponent(partMatch[2])}catch(err){value=partMatch[2]}lastQuery.filterQuery[filterId]=value}}}return hasMatches&&(lastQuery.q=this.controllerInstance.appendDynamicFieldsParameters(lastQuery.q),lastQuery.q=this.controllerInstance.appendSecuredFiltersParameters(lastQuery.q),lastQuery.q=this.controllerInstance.appendDefaultFilters(lastQuery.q),lastQuery.q=this.controllerInstance.appendFixedFilters(lastQuery.q),lastQuery.q.exclusionQuery=this.controllerInstance.getExclusionFilters(),this.controllerInstance.setSearchQuery(lastQuery.q.searchQuery),this.sendSearchQuery(lastQuery.q.searchQuery,lastQuery.filterQuery,lastQuery.q)),hasMatches}};